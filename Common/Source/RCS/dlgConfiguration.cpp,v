head	8.12;
access;
symbols
	beta8:8.1;
locks
	root:8.12; strict;
comment	@// @;


8.12
date	2010.12.13.12.50.04;	author root;	state Exp;
branches;
next	8.11;

8.11
date	2009.11.22.21.47.38;	author root;	state Exp;
branches;
next	8.10;

8.10
date	2009.11.14.23.45.09;	author root;	state Exp;
branches;
next	8.9;

8.9
date	2009.11.06.22.50.20;	author root;	state Exp;
branches;
next	8.8;

8.8
date	2009.11.05.19.21.08;	author root;	state Exp;
branches;
next	8.7;

8.7
date	2009.11.01.15.19.50;	author root;	state Exp;
branches;
next	8.6;

8.6
date	2009.10.19.22.29.46;	author root;	state Exp;
branches;
next	8.5;

8.5
date	2009.10.12.16.13.10;	author root;	state Exp;
branches;
next	8.4;

8.4
date	2009.06.28.21.31.53;	author root;	state Exp;
branches;
next	8.3;

8.3
date	2009.06.27.17.18.20;	author root;	state Exp;
branches;
next	8.2;

8.2
date	2009.06.24.10.03.43;	author root;	state Exp;
branches;
next	8.1;

8.1
date	2009.06.19.20.28.25;	author venta;	state Exp;
branches;
next	1.3;

1.3
date	2009.06.15.19.47.17;	author root;	state Exp;
branches;
next	1.2;

1.2
date	2009.06.01.21.18.57;	author root;	state Exp;
branches;
next	1.1;

1.1
date	2009.05.27.12.04.05;	author root;	state Exp;
branches;
next	;


desc
@@

8.12
log
@*** empty log message ***
@
text
@/*
   LK8000 Tactical Flight Computer -  WWW.LK8000.IT
   Released under GNU/GPL License v.2
   See CREDITS.TXT file for authors and copyrights

   $Id: dlgConfiguration.cpp,v 8.11 2009/11/22 21:47:38 root Exp root $
*/


#include "StdAfx.h"
#include <aygshell.h>

#include "XCSoar.h"
#include "Utils2.h"
#include "MapWindow.h"
#include "Terrain.h"
#include "GaugeFLARM.h"

#include "WindowControls.h"
#include "Statistics.h"
#include "externs.h"
#include "McReady.h"
#include "dlgTools.h"
#include "device.h"

#include "compatibility.h"
#ifdef OLDPPC
#include "XCSoarProcess.h"
#else
#include "Process.h"
#endif

#include "McReady.h"
#include "Utils.h"
#include "InfoBoxLayout.h"
#include "Waypointparser.h"
#include "LKMapWindow.h"

static HFONT TempInfoWindowFont;
static HFONT TempTitleWindowFont;
static HFONT TempMapWindowFont;
static HFONT TempTitleSmallWindowFont;
static HFONT TempMapWindowBoldFont;
static HFONT TempCDIWindowFont; // New
static HFONT TempMapLabelFont;
static HFONT TempStatisticsFont;
static HFONT TempUseCustomFontsFont;

extern LOGFONT autoInfoWindowLogFont;
extern LOGFONT autoTitleWindowLogFont;
extern LOGFONT autoMapWindowLogFont;
extern LOGFONT autoTitleSmallWindowLogFont;
extern LOGFONT autoMapWindowBoldLogFont;
extern LOGFONT autoCDIWindowLogFont; // New
extern LOGFONT autoMapLabelLogFont;
extern LOGFONT autoStatisticsLogFont;

// #define ISPARAGLIDER (AircraftCategory == (AircraftCategory_t)umParaglider)

extern void InitializeOneFont (HFONT * theFont, 
                               const TCHAR FontRegKey[] , 
                               LOGFONT autoLogFont, 
                               LOGFONT * LogFontUsed);

extern bool dlgFontEditShowModal(const TCHAR * FontDescription, 
                          const TCHAR * FontRegKey, 
                          LOGFONT autoLogFont);
// default user level is now expert
int UserLevel = 1; 

static bool changed = false;
static bool taskchanged = false;
static bool requirerestart = false;
static bool utcchanged = false;
static bool waypointneedsave = false;
static bool FontRegistryChanged=false;
int config_page=0;
static WndForm *wf=NULL;
static WndFrame *wConfig1=NULL;
static WndFrame *wConfig2=NULL;
static WndFrame *wConfig3=NULL;
static WndFrame *wConfig4=NULL;
static WndFrame *wConfig5=NULL;
static WndFrame *wConfig6=NULL;
static WndFrame *wConfig7=NULL;
static WndFrame *wConfig8=NULL;
static WndFrame *wConfig9=NULL;
static WndFrame *wConfig10=NULL;
static WndFrame *wConfig11=NULL;
static WndFrame *wConfig12=NULL;
static WndFrame *wConfig13=NULL;
static WndFrame *wConfig14=NULL;
static WndFrame *wConfig15=NULL;
static WndFrame *wConfig16=NULL;
static WndFrame *wConfig17=NULL;
static WndFrame *wConfig18=NULL;
static WndFrame *wConfig19=NULL;
static WndFrame *wConfig20=NULL;
static WndFrame *wConfig21=NULL;
static WndFrame *wConfig22=NULL; 
static WndFrame *wConfig23=NULL; 
static WndFrame *wConfig24=NULL; 
static WndFrame *wConfig25=NULL; 
//static WndFrame *wConfig26=NULL; 
//static WndFrame *wConfig27=NULL; 
// ADDPAGE  HERE
static WndButton *buttonPilotName=NULL;
static WndButton *buttonAircraftType=NULL;
static WndButton *buttonAircraftRego=NULL;
static WndButton *buttonLoggerID=NULL;
static WndButton *buttonCopy=NULL;
static WndButton *buttonPaste=NULL;

#define NUMPAGES 25 		// ADDPAGE FIX HERE  27 as of 101126



static void UpdateButtons(void) {
  TCHAR text[120];
  TCHAR val[100];
  if (buttonPilotName) {
    GetRegistryString(szRegistryPilotName, val, 100);
    if (_tcslen(val)<=0) {
      _stprintf(val, gettext(TEXT("(blank)")));
    }
    _stprintf(text,TEXT("%s: %s"), gettext(TEXT("Pilot name")), val);
    buttonPilotName->SetCaption(text);
  }
  if (buttonAircraftType) {
    GetRegistryString(szRegistryAircraftType, val, 100);
    if (_tcslen(val)<=0) {
      _stprintf(val, gettext(TEXT("(blank)")));
    }
    _stprintf(text,TEXT("%s: %s"), gettext(TEXT("Aircraft type")), val);
    buttonAircraftType->SetCaption(text);
  }
  if (buttonAircraftRego) {
    GetRegistryString(szRegistryAircraftRego, val, 100);
    if (_tcslen(val)<=0) {
      _stprintf(val, gettext(TEXT("(blank)")));
    }
    _stprintf(text,TEXT("%s: %s"), gettext(TEXT("Aircraft Reg")), val);
    buttonAircraftRego->SetCaption(text);
  }
  if (buttonLoggerID) {
    GetRegistryString(szRegistryLoggerID, val, 100);
    if (_tcslen(val)<=0) {
      _stprintf(val, gettext(TEXT("(blank)")));
    }
    _stprintf(text,TEXT("%s: %s"), gettext(TEXT("Logger ID")), val);
    buttonLoggerID->SetCaption(text);
  }
}

extern bool EnableAnimation;


static void NextPage(int Step){
  config_page += Step;
  if (!EngineeringMenu) { 
	  if (config_page>=(NUMPAGES-2)) { config_page=0; } // ADDPAGE FIX HERE
	  if (config_page<0) { config_page=NUMPAGES-3; } // ADDPAGE FIX HERE
  } else {
	  if (config_page>=NUMPAGES) { config_page=0; }
	  if (config_page<0) { config_page=NUMPAGES-1; }
  }
  switch(config_page) {
  case 0:
    wf->SetCaption(gettext(TEXT("1 Site")));
    break;
  case 1:
    wf->SetCaption(gettext(TEXT("2 Airspace")));
    break;
  case 2:
    wf->SetCaption(gettext(TEXT("3 Map Display")));
    break;
  case 3:
    wf->SetCaption(gettext(TEXT("4 Terrain Display")));
    break;
  case 4:
    wf->SetCaption(gettext(TEXT("5 Glide Computer")));
    break;
  case 5:
    wf->SetCaption(gettext(TEXT("6 Safety factors")));
    break;
  case 6:
    wf->SetCaption(gettext(TEXT("7 Aircraft")));
    break;
  case 7:
    wf->SetCaption(gettext(TEXT("8 Devices")));
    break;
  case 8:
    wf->SetCaption(gettext(TEXT("9 Units")));
    break;
  case 9:
    wf->SetCaption(gettext(TEXT("10 Interface")));
    break;
  case 10:
    wf->SetCaption(gettext(TEXT("11 Appearance")));
    break;
  case 11:
    wf->SetCaption(gettext(TEXT("12 Fonts")));
    break;
  case 12:
    wf->SetCaption(gettext(TEXT("13 Map Overlays ")));
    break;
  case 13:
    wf->SetCaption(gettext(TEXT("14 Task")));
    break;
  case 14:
    wf->SetCaption(gettext(TEXT("15 Task rules")));
    break;
  case 15:
    wf->SetCaption(gettext(TEXT("16 InfoBox Cruise")));
    break;
  case 16:
    wf->SetCaption(gettext(TEXT("17 InfoBox Thermal")));
    break;
  case 17:
    wf->SetCaption(gettext(TEXT("18 InfoBox Final Glide")));
    break;
  case 18:
    wf->SetCaption(gettext(TEXT("19 InfoBox Auxiliary")));
    break;
  case 19:
    wf->SetCaption(gettext(TEXT("20 Logger")));
    break;
  case 20:
    wf->SetCaption(gettext(TEXT("21 Waypoint Edit")));
    break;
  case 21:
    wf->SetCaption(gettext(TEXT("22 System")));
    break;
  case 22:
    wf->SetCaption(gettext(TEXT("23 Paragliders/Delta specials")));
    break;
  case 23:
    wf->SetCaption(TEXT("24 Engineering Menu 1"));
    break;
  case 24:
    wf->SetCaption(TEXT("25 Engineering Menu 2"));
    break;
  case 25:
    wf->SetCaption(TEXT("26 Engineering Menu 3"));
    break;
  case 26:
    wf->SetCaption(TEXT("27 Engineering Menu 4: old Vario"));
    break;
  } // ADDPAGE FIX HERE
  if ((config_page>=15) && (config_page<=18)) {
    if (buttonCopy) {
      buttonCopy->SetVisible(true);
    }
    if (buttonPaste) {
      buttonPaste->SetVisible(true);
    }
  } else {
    if (buttonCopy) {
      buttonCopy->SetVisible(false);
    }
    if (buttonPaste) {
      buttonPaste->SetVisible(false);
    }
  }
  wConfig1->SetVisible(config_page == 0);
  wConfig2->SetVisible(config_page == 1); 
  wConfig3->SetVisible(config_page == 2); 
  wConfig4->SetVisible(config_page == 3); 
  wConfig5->SetVisible(config_page == 4); 
  wConfig6->SetVisible(config_page == 5); 
  wConfig7->SetVisible(config_page == 6); 
  wConfig8->SetVisible(config_page == 7); 
  wConfig9->SetVisible(config_page == 8); 
  wConfig10->SetVisible(config_page == 9); 
  wConfig11->SetVisible(config_page == 10); 
  wConfig12->SetVisible(config_page == 11); 
  wConfig13->SetVisible(config_page == 12); 
  wConfig14->SetVisible(config_page == 13); 
  wConfig15->SetVisible(config_page == 14); 
  wConfig16->SetVisible(config_page == 15); 
  wConfig17->SetVisible(config_page == 16); 
  wConfig18->SetVisible(config_page == 17); 
  wConfig19->SetVisible(config_page == 18); 
  wConfig20->SetVisible(config_page == 19); 
  wConfig21->SetVisible(config_page == 20); 
  wConfig22->SetVisible(config_page == 21);  
  wConfig23->SetVisible(config_page == 22);  
  wConfig24->SetVisible(config_page == 23);  
  wConfig25->SetVisible(config_page == 24);  
 // wConfig26->SetVisible(config_page == 25);  
 //  wConfig27->SetVisible(config_page == 26);  
} // ADDPAGE FIX HERE



static void OnSetupDeviceAClicked(WindowControl * Sender){
  (void)Sender;

  #if (ToDo)
    devA()->DoSetup();
    wf->FocusNext(NULL);
  #endif

// this is a hack, devices dont jet support device dependant setup dialogs

#if NOSIM
  if (!SIMMODE) {
	if ((devA() == NULL) || (_tcscmp(devA()->Name,TEXT("Vega")) != 0)) {
		return;
	}
  }
#else
#ifndef _SIM_
    if ((devA() == NULL) ||
	(_tcscmp(devA()->Name,TEXT("Vega")) != 0)) {
      return;
    }
#endif
#endif

#ifdef VEGAVOICE
    changed = dlgConfigurationVarioShowModal();
#endif
    // this is a hack to get the dialog to retain focus because
    // the progress dialog in the vario configuration somehow causes
    // focus problems
    wf->FocusNext(NULL);
}


static void OnSetupDeviceBClicked(WindowControl * Sender){
  (void)Sender;

  #if (ToDo)
    devB()->DoSetup();
    wf->FocusNext(NULL);
  #endif

// this is a hack, devices dont jet support device dependant setup dialogs
#if NOSIM
  if (!SIMMODE) {
	if ((devB() == NULL) || (_tcscmp(devB()->Name,TEXT("Vega")) != 0)) {
		return;
	}
  }
#else
#ifndef _SIM_
    if ((devB() == NULL) ||
	(_tcscmp(devB()->Name,TEXT("Vega")) != 0)) {
      return;
    }
#endif
#endif
#ifdef VEGAVOICE
    changed = dlgConfigurationVarioShowModal();
#endif

    // this is a hack to get the dialog to retain focus because
    // the progress dialog in the vario configuration somehow causes
    // focus problems
    wf->FocusNext(NULL);
}

static void UpdateDeviceSetupButton(int DeviceIdx, TCHAR *Name){

  WndButton *wb;

  if (DeviceIdx == 0){

    wb = ((WndButton *)wf->FindByName(TEXT("cmdSetupDeviceA")));
    if (wb != NULL) {
      if (_tcscmp(Name, TEXT("Vega")) == 0)
        wb->SetVisible(true);
      else 
        wb->SetVisible(false);
    }

  }

  if (DeviceIdx == 1){

    wb = ((WndButton *)wf->FindByName(TEXT("cmdSetupDeviceB")));
    if (wb != NULL) {
      if (_tcscmp(Name, TEXT("Vega")) == 0)
        wb->SetVisible(true);
      else 
        wb->SetVisible(false);
    }

  }

}


static void OnUserLevel(DataField *Sender, DataField::DataAccessKind_t Mode){
  WndProperty* wp;

  switch(Mode){
    case DataField::daGet:
    break;
    case DataField::daPut:
    case DataField::daChange:
      wp = (WndProperty*)wf->FindByName(TEXT("prpUserLevel"));
      if (wp) {
        if (wp->GetDataField()->GetAsInteger() != UserLevel) {
          UserLevel = wp->GetDataField()->GetAsInteger();
          changed = true;
          SetToRegistry(szRegistryUserLevel,UserLevel);
          wf->FilterAdvanced(UserLevel>0);
        }
      }
    break;
	default: 
		StartupStore(_T("........... DBG-901%s"),NEWLINE); // 091105
		break;
  }
}


static void OnDeviceAData(DataField *Sender, DataField::DataAccessKind_t Mode){

  switch(Mode){
    case DataField::daGet:
    break;
    case DataField::daPut:
    case DataField::daChange:
      UpdateDeviceSetupButton(0, Sender->GetAsString());
    break;
	default: 
		StartupStore(_T("........... DBG-902%s"),NEWLINE); // 091105
		break;
  }

}

static void OnDeviceBData(DataField *Sender, DataField::DataAccessKind_t Mode){

  switch(Mode){
    case DataField::daGet:
    break;
    case DataField::daPut:
    case DataField::daChange:
      UpdateDeviceSetupButton(1, Sender->GetAsString());
    break;
	default: 
		StartupStore(_T("........... DBG-903%s"),NEWLINE); // 091105
		break;
  }

}


static void ResetFonts(bool bUseCustom) {
// resest fonts when UseCustomFonts is turned off

  int UseCustomFontsold = UseCustomFonts;
  UseCustomFonts=bUseCustom;



  InitializeOneFont (&TempUseCustomFontsFont, 
                        TEXT("THIS FONT IS NOT CUSTOMIZABLE"), 
                        autoMapWindowLogFont,
                        NULL);



  InitializeOneFont (&TempInfoWindowFont, 
                        szRegistryFontInfoWindowFont, 
                        autoInfoWindowLogFont,
                        NULL);

  InitializeOneFont (&TempTitleWindowFont, 
                        szRegistryFontTitleWindowFont, 
                        autoTitleWindowLogFont,
                        NULL);

  InitializeOneFont (&TempMapWindowFont, 
                        szRegistryFontMapWindowFont, 
                        autoMapWindowLogFont,
                        NULL);

  InitializeOneFont (&TempTitleSmallWindowFont, 
                        szRegistryFontTitleSmallWindowFont, 
                        autoTitleSmallWindowLogFont,
                        NULL);

  InitializeOneFont (&TempMapWindowBoldFont, 
                        szRegistryFontMapWindowBoldFont, 
                        autoMapWindowBoldLogFont,
                        NULL);

  InitializeOneFont (&TempCDIWindowFont, 
                        szRegistryFontCDIWindowFont, 
                        autoCDIWindowLogFont,
                        NULL);

  InitializeOneFont (&TempMapLabelFont, 
                        szRegistryFontMapLabelFont, 
                        autoMapLabelLogFont,
                        NULL);

  InitializeOneFont (&TempStatisticsFont, 
                        szRegistryFontStatisticsFont, 
                        autoStatisticsLogFont,
                        NULL);

  UseCustomFonts=UseCustomFontsold;
}

static void ShowFontEditButtons(bool bVisible) {
  WndProperty * wp;
  wp = (WndProperty*)wf->FindByName(TEXT("cmdInfoWindowFont"));
  if (wp) {
    wp->SetVisible(bVisible);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("cmdTitleWindowFont"));
  if (wp) {
    wp->SetVisible(bVisible);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("cmdMapWindowFont"));
  if (wp) {
    wp->SetVisible(bVisible);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("cmdTitleSmallWindowFont"));
  if (wp) {
    wp->SetVisible(bVisible);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("cmdMapWindowBoldFont"));
  if (wp) {
    wp->SetVisible(bVisible);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("cmdCDIWindowFont"));
  if (wp) {
    wp->SetVisible(bVisible);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("cmdMapLabelFont"));
  if (wp) {
    wp->SetVisible(bVisible);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("cmdStatisticsFont"));
  if (wp) {
    wp->SetVisible(bVisible);
  }
}


static void RefreshFonts(void) {

  WndProperty * wp;

  wp = (WndProperty*)wf->FindByName(TEXT("prpUseCustomFonts"));
  if (wp) {
    bool bUseCustomFonts= ((DataFieldBoolean*)(wp->GetDataField()))->GetAsBoolean();
    ResetFonts(bUseCustomFonts);
    wp->SetFont(TempUseCustomFontsFont); // this font is never customized
    wp->SetVisible(false);
    wp->SetVisible(true);
    ShowFontEditButtons(bUseCustomFonts);

  }

// now set SampleTexts on the Fonts frame
  wp = (WndProperty*)wf->FindByName(TEXT("prpInfoWindowFont"));
  if (wp) {
    wp->SetFont(TempInfoWindowFont);
    wp->SetVisible(false);
    wp->SetVisible(true);
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTitleWindowFont"));
  if (wp) {
    wp->SetFont(TempTitleWindowFont);
    wp->SetVisible(false);
    wp->SetVisible(true);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpMapWindowFont"));
  if (wp) {
    wp->SetFont(TempMapWindowFont);
    wp->SetVisible(false);
    wp->SetVisible(true);
  }


  wp = (WndProperty*)wf->FindByName(TEXT("prpTitleSmallWindowFont"));
  if (wp) {
    wp->SetFont(TempTitleSmallWindowFont);
    wp->SetVisible(false);
    wp->SetVisible(true);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpMapWindowBoldFont"));
  if (wp) {
    wp->SetFont(TempMapWindowBoldFont);
    wp->SetVisible(false);
    wp->SetVisible(true);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpCDIWindowFont"));
  if (wp) {
    wp->SetFont(TempCDIWindowFont);
    wp->SetVisible(false);
    wp->SetVisible(true);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpMapLabelFont"));
  if (wp) {
    wp->SetFont(TempMapLabelFont);
    wp->SetVisible(false);
    wp->SetVisible(true);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpStatisticsFont"));
  if (wp) {
    wp->SetFont(TempStatisticsFont);
    wp->SetVisible(false);
    wp->SetVisible(true);
  }

  // now fix the rest of the dlgConfiguration fonts:
  wf->SetFont(TempMapWindowBoldFont);
  wf->SetTitleFont(TempMapWindowBoldFont);

  wp = (WndProperty*)wf->FindByName(TEXT("cmdNext"));
  if (wp) {
    wp->SetFont(TempCDIWindowFont);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("cmdPrev"));
  if (wp) {
    wp->SetFont(TempCDIWindowFont);
  }

}



static void OnUseCustomFontData(DataField *Sender, DataField::DataAccessKind_t Mode) {

  switch(Mode){
    case DataField::daGet:
    break;

    case DataField::daPut: 
    break;

    case DataField::daChange:
      RefreshFonts();

    break;
	default: 
		StartupStore(_T("........... DBG-904%s"),NEWLINE); // 091105
		break;
  }
}

static void GetFontDescription(TCHAR Description[], TCHAR * prpName, int iMaxLen)
{
  WndProperty * wp;
  wp = (WndProperty*)wf->FindByName(prpName);
  if (wp) {
    _tcsncpy(Description, wp->GetCaption(), iMaxLen-1);
  }
}

static void OnEditInfoWindowFontClicked(WindowControl *Sender) {
  // updates registry for font info and updates LogFont values
#define MAX_EDITFONT_DESC_LEN 100
  TCHAR FontDesc[MAX_EDITFONT_DESC_LEN];
  GetFontDescription(FontDesc, TEXT("prpInfoWindowFont"), MAX_EDITFONT_DESC_LEN);
  if (dlgFontEditShowModal(FontDesc,
                            szRegistryFontInfoWindowFont, 
                            autoInfoWindowLogFont)) {
    FontRegistryChanged=true;
    RefreshFonts(); 
  }
}

static void OnEditTitleWindowFontClicked(WindowControl *Sender) {
  TCHAR FontDesc[MAX_EDITFONT_DESC_LEN];
  GetFontDescription(FontDesc, TEXT("prpTitleWindowFont"), MAX_EDITFONT_DESC_LEN);
  if (dlgFontEditShowModal(FontDesc,
                            szRegistryFontTitleWindowFont, 
                            autoTitleWindowLogFont)) {
    FontRegistryChanged=true;
    RefreshFonts(); 
  }
}
static void OnEditMapWindowFontClicked(WindowControl *Sender) {
  TCHAR FontDesc[MAX_EDITFONT_DESC_LEN];
  GetFontDescription(FontDesc, TEXT("prpMapWindowFont"), MAX_EDITFONT_DESC_LEN);
  if (dlgFontEditShowModal(FontDesc,
                            szRegistryFontMapWindowFont, 
                            autoMapWindowLogFont)) {
    FontRegistryChanged=true;
    RefreshFonts(); 
  }
}
static void OnEditTitleSmallWindowFontClicked(WindowControl *Sender) {
  TCHAR FontDesc[MAX_EDITFONT_DESC_LEN];
  GetFontDescription(FontDesc, TEXT("prpTitleSmallWindowFont"), MAX_EDITFONT_DESC_LEN);
  if (dlgFontEditShowModal(FontDesc,
                            szRegistryFontTitleSmallWindowFont, 
                            autoTitleSmallWindowLogFont)) {
    FontRegistryChanged=true;
    RefreshFonts(); 
  }
}
static void OnEditMapWindowBoldFontClicked(WindowControl *Sender) {
  TCHAR FontDesc[MAX_EDITFONT_DESC_LEN];
  GetFontDescription(FontDesc, TEXT("prpMapWindowBoldFont"), MAX_EDITFONT_DESC_LEN);
  if (dlgFontEditShowModal(FontDesc,
                            szRegistryFontMapWindowBoldFont, 
                            autoMapWindowBoldLogFont)) {
    FontRegistryChanged=true;
    RefreshFonts(); 
  }
}
static void OnEditCDIWindowFontClicked(WindowControl *Sender) {
  TCHAR FontDesc[MAX_EDITFONT_DESC_LEN];
  GetFontDescription(FontDesc, TEXT("prpCDIWindowFont"), MAX_EDITFONT_DESC_LEN);
  if (dlgFontEditShowModal(FontDesc,
                            szRegistryFontCDIWindowFont, 
                            autoCDIWindowLogFont)) {
    FontRegistryChanged=true;
    RefreshFonts(); 
  }
}
static void OnEditMapLabelFontClicked(WindowControl *Sender) {
  TCHAR FontDesc[MAX_EDITFONT_DESC_LEN];
  GetFontDescription(FontDesc, TEXT("prpMapLabelFont"), MAX_EDITFONT_DESC_LEN);
  if (dlgFontEditShowModal(FontDesc,
                            szRegistryFontMapLabelFont, 
                            autoMapLabelLogFont)) {
    FontRegistryChanged=true;
    RefreshFonts(); 
  }
}
static void OnEditStatisticsFontClicked(WindowControl *Sender) {
  TCHAR FontDesc[MAX_EDITFONT_DESC_LEN];
  GetFontDescription(FontDesc, TEXT("prpStatisticsFont"), MAX_EDITFONT_DESC_LEN);
  if (dlgFontEditShowModal(FontDesc,
                            szRegistryFontStatisticsFont, 
                            autoStatisticsLogFont)) {
    FontRegistryChanged=true;
    RefreshFonts(); 
  }
}


static void OnAircraftRegoClicked(WindowControl *Sender) {
	(void)Sender;
  TCHAR Temp[100];
  if (buttonAircraftRego) {
    GetRegistryString(szRegistryAircraftRego,Temp,100);
    dlgTextEntryShowModal(Temp,100);
    SetRegistryString(szRegistryAircraftRego,Temp);
    changed = true;
  }
  UpdateButtons();
}


static void OnAircraftTypeClicked(WindowControl *Sender) {
	(void)Sender;
  TCHAR Temp[100];
  if (buttonAircraftType) {
    GetRegistryString(szRegistryAircraftType,Temp,100);
    dlgTextEntryShowModal(Temp,100);
    SetRegistryString(szRegistryAircraftType,Temp);
    changed = true;
  }
  UpdateButtons();
}


static void OnPilotNameClicked(WindowControl *Sender) {
	(void)Sender;
  TCHAR Temp[100];
  if (buttonPilotName) {
    GetRegistryString(szRegistryPilotName,Temp,100);
    dlgTextEntryShowModal(Temp,100);
    SetRegistryString(szRegistryPilotName,Temp);
    changed = true;
  }
  UpdateButtons();
}


static void OnLoggerIDClicked(WindowControl *Sender) {
	(void)Sender;
  TCHAR Temp[100];
  if (buttonLoggerID) {
    GetRegistryString(szRegistryLoggerID,Temp,100);
    dlgTextEntryShowModal(Temp,100);
    SetRegistryString(szRegistryLoggerID,Temp);
    changed = true;
    ReadAssetNumber();
  }
  UpdateButtons();
}


static void OnAirspaceColoursClicked(WindowControl * Sender){
	(void)Sender;
  dlgAirspaceShowModal(true);
}

#if LKTOPO
static void OnSetTopologyClicked(WindowControl * Sender){
	(void)Sender;
  dlgTopologyShowModal();
}
/*
static void OnResetTopologyClicked(WindowControl * Sender){
	(void)Sender;
  dlgTopologyShowModal();
}
*/
#endif
static void OnSetCustomKeysClicked(WindowControl * Sender){
	(void)Sender;
  dlgCustomKeysShowModal();
}

static void OnAirspaceModeClicked(WindowControl * Sender){
	(void)Sender;
  dlgAirspaceShowModal(false);
}

static void OnNextClicked(WindowControl * Sender){
	(void)Sender;
  NextPage(+1);
}

static void OnPrevClicked(WindowControl * Sender){
	(void)Sender;
  NextPage(-1);
}

static void OnCloseClicked(WindowControl * Sender){
	(void)Sender;
  wf->SetModalResult(mrOK);
}

static int cpyInfoBox[10];

static int page2mode(void) {
  return config_page-15;  // RLD upped by 1
}


static void InfoBoxPropName(TCHAR *name, int item, int mode) {
  _tcscpy(name,TEXT("prpInfoBox"));
  switch (mode) {
  case 0:
    _tcscat(name,TEXT("Circling"));
    break;
  case 1:
    _tcscat(name,TEXT("Cruise"));
    break;
  case 2:
    _tcscat(name,TEXT("FinalGlide"));
    break;
  case 3:
    _tcscat(name,TEXT("Aux"));
    break;
  }
  TCHAR buf[3];
  _stprintf(buf,TEXT("%1d"), item);
  _tcscat(name,buf);
}

static void OnCopy(WindowControl *Sender) {
  (void)Sender;
  int mode = page2mode();
  TCHAR name[80];
  if ((mode<0)||(mode>3)) {
    return;
  }

  for (int item=0; item<9; item++) {
    InfoBoxPropName(name, item, mode);
    WndProperty *wp;
    wp = (WndProperty*)wf->FindByName(name);
    if (wp) {
      cpyInfoBox[item] = wp->GetDataField()->GetAsInteger();
    }
  }
}

static void OnPaste(WindowControl *Sender) {
  (void)Sender;
  int mode = page2mode();
  TCHAR name[80];
  if ((mode<0)||(mode>3)||(cpyInfoBox[0]<0)) {
    return;
  }

  if(MessageBoxX(hWndMapWindow,
		 gettext(TEXT("Overwrite?")),
		 gettext(TEXT("InfoBox paste")),
		 MB_YESNO|MB_ICONQUESTION) == IDYES) {

    for (int item=0; item<9; item++) {
      InfoBoxPropName(name, item, mode);
      WndProperty *wp;
      wp = (WndProperty*)wf->FindByName(name);
      if (wp && (cpyInfoBox[item]>=0)&&(cpyInfoBox[item]<NUMSELECTSTRINGS)) {
	wp->GetDataField()->Set(cpyInfoBox[item]);
	wp->RefreshDisplay();
      }
    }
  }
}

static int FormKeyDown(WindowControl * Sender, WPARAM wParam, LPARAM lParam){
	(void)lParam;
	(void)Sender;
  switch(wParam & 0xffff){
    case '6':
      SetFocus(((WndButton *)wf->FindByName(TEXT("cmdPrev")))->GetHandle());
      NextPage(-1);
      //((WndButton *)wf->FindByName(TEXT("cmdPrev")))->SetFocused(true, NULL);
    return(0);
    case '7':
      SetFocus(((WndButton *)wf->FindByName(TEXT("cmdNext")))->GetHandle());
      NextPage(+1);
      //((WndButton *)wf->FindByName(TEXT("cmdNext")))->SetFocused(true, NULL);
    return(0);
  }
  return(1);
}

static void SetLocalTime(void) {
  WndProperty* wp;
  TCHAR temp[20];
  Units::TimeToText(temp, 
		    (int)TimeLocal((int)(GPS_INFO.Time)));
  
  wp = (WndProperty*)wf->FindByName(TEXT("prpLocalTime"));
  if (wp) {
    wp->SetText(temp);
    wp->RefreshDisplay();
  }
}

static void OnUTCData(DataField *Sender, DataField::DataAccessKind_t Mode){
//  WndProperty* wp;
  int ival;

  switch(Mode){
    case DataField::daGet:
    break;
    case DataField::daPut: 
    case DataField::daChange:
      ival = iround(Sender->GetAsFloat()*3600.0);
      if (UTCOffset != ival) {
	UTCOffset = ival;
	utcchanged = true;
      }
      SetLocalTime();
    break;
	default: 
		StartupStore(_T("........... DBG-905%s"),NEWLINE); // 091105
		break;
  }

}

static int lastSelectedPolarFile = -1;

static void OnPolarFileData(DataField *Sender, DataField::DataAccessKind_t Mode){
  WndProperty* wp;

  switch(Mode){
    case DataField::daGet:
    break;
    case DataField::daPut:
    case DataField::daChange:
      if (Sender->GetAsString() != NULL && _tcscmp(Sender->GetAsString(), TEXT("")) != 0){
        // then ... set Polar Tape to Winpilot

        wp = (WndProperty *)wf->FindByName(TEXT("prpPolarType"));

        if (wp != NULL){
          wp->GetDataField()->SetAsInteger(POLARUSEWINPILOTFILE);
          wp->RefreshDisplay();
        }

      }
    break;
	default: 
		StartupStore(_T("........... DBG-907%s"),NEWLINE); // 091105
		break;
  }

}


static void OnPolarTypeData(DataField *Sender, DataField::DataAccessKind_t Mode){
  WndProperty* wp;

  switch(Mode){
    case DataField::daGet:
    break;
    case DataField::daPut:
    case DataField::daChange:
      wp = (WndProperty *)wf->FindByName(TEXT("prpPolarFile"));

      if (Sender->GetAsInteger() != POLARUSEWINPILOTFILE){
        // then ... clear Winpilot File if Polar Type is not WinpilotFile

        if (wp != NULL && wp->GetDataField()->GetAsInteger() > 0){
          lastSelectedPolarFile = wp->GetDataField()->GetAsInteger();
          wp->GetDataField()->SetAsInteger(-1);
          wp->RefreshDisplay();
        }

      } else {
        if (wp != NULL && wp->GetDataField()->GetAsInteger() <= 0 && lastSelectedPolarFile > 0){
          wp->GetDataField()->SetAsInteger(lastSelectedPolarFile);
          wp->RefreshDisplay();
        }

      }
    break;
	default: 
		StartupStore(_T("........... DBG-906%s"),NEWLINE); // 091105
		break;
  }

}


extern void OnInfoBoxHelp(WindowControl * Sender);

static void OnWaypointNewClicked(WindowControl * Sender){
  (void)Sender;

  // Cannot save waypoint if no file
  if ( NumberOfWayPoints<=NUMRESWP) { 
	MessageBoxX(hWndMapWindow, 
	gettext(TEXT("No waypoint file selected, cannot save.")),
               gettext(TEXT("New Waypoint")),
               MB_OK|MB_ICONEXCLAMATION);

	return; 
  }
 
  WAYPOINT edit_waypoint;
  edit_waypoint.Latitude = GPS_INFO.Latitude;
  edit_waypoint.Longitude = GPS_INFO.Longitude;
  edit_waypoint.FileNum = 0; // default, put into primary waypoint file
  edit_waypoint.Flags = 0;
  #if CUPCOM
  edit_waypoint.Comment=(TCHAR*)malloc(100*sizeof(TCHAR)); //@@ bugfix 101110
  _tcscpy(edit_waypoint.Comment,_T(""));
  #else
  edit_waypoint.Comment[0] = 0;
  #endif
  edit_waypoint.Name[0] = 0;
  edit_waypoint.Details = 0;
  edit_waypoint.Number = NumberOfWayPoints;
#ifdef CUPSUP
  edit_waypoint.Format = LKW_NEW;	// 100208
  edit_waypoint.RunwayLen = 0;
  edit_waypoint.RunwayDir = -1;
  edit_waypoint.Style = 1; // normal turnpoint
  edit_waypoint.Code[0]=0;
  edit_waypoint.Freq[0]=0;
  edit_waypoint.Country[0]=0;
#endif 
  dlgWaypointEditShowModal(&edit_waypoint);

  // SeeYou style not correct when new waypoint created
  // This setting will override Flags when reloading the file after changes!
  if ( (edit_waypoint.Flags & AIRPORT) == AIRPORT) {
	edit_waypoint.Style=5;  // airport
  } else {
	if ( (edit_waypoint.Flags & LANDPOINT) == LANDPOINT) {
		edit_waypoint.Style=3;  // outlanding
	}
  }
  // else it is already a turnpoint


  if (_tcslen(edit_waypoint.Name)>0) {
    LockTaskData();
    WAYPOINT *new_waypoint = GrowWaypointList();
    if (new_waypoint) {
      memcpy(new_waypoint,&edit_waypoint,sizeof(WAYPOINT));
      new_waypoint->Details= 0;
      waypointneedsave = true;
    } 
    UnlockTaskData();
  }
}


static void OnWaypointEditClicked(WindowControl * Sender){
	(void)Sender;
  int res;
  res = dlgWayPointSelect();
  if (res != -1){
	#ifdef CUPSUP
	#if 0 // 101214 READ ONLY FILES
	if ( WayPointList[res].Format == LKW_COMPE) {      // 100212
		MessageBoxX(hWndMapWindow, 
		gettext(TEXT("This waypoint is read-only")),
                gettext(TEXT("CompeGPS Waypoint")),
                MB_OK|MB_ICONEXCLAMATION);

		return;
	}
	#endif

	if ( WayPointList[res].Format == LKW_VIRTUAL) {      // 100212
		MessageBoxX(hWndMapWindow, 
		gettext(TEXT("This waypoint is read-only")),
                gettext(TEXT("VIRTUAL Waypoint")),
                MB_OK|MB_ICONEXCLAMATION);

		return;
	}

	#endif

    dlgWaypointEditShowModal(&WayPointList[res]);
    waypointneedsave = true;
  }
}

static void AskWaypointSave(void) {
  if (WaypointsOutOfRange==2) {

    if(MessageBoxX(hWndMapWindow,
                   gettext(TEXT("Waypoints excluded, save anyway?")),
                   gettext(TEXT("Waypoints outside terrain")),
                   MB_YESNO|MB_ICONQUESTION) == IDYES) {
      
      WaypointWriteFiles();
      
      WAYPOINTFILECHANGED= true;
      changed = true;
      
    }
  } else {
    
    WaypointWriteFiles();
    
    WAYPOINTFILECHANGED= true;
    changed = true;
  }
  waypointneedsave = false;
}


static void OnWaypointSaveClicked(WindowControl * Sender){
  (void)Sender;

  AskWaypointSave();
}

static void OnWaypointDeleteClicked(WindowControl * Sender){
	(void)Sender;
  int res;
  res = dlgWayPointSelect();
  if (res > RESWP_END) { // 100212
	#ifdef CUPSUP
	#if 0 // 101214 READ ONLY FILES
	if ( WayPointList[res].Format == LKW_COMPE ) { // 100212
		MessageBoxX(hWndMapWindow, gettext(TEXT("This waypoint is read-only")),
			gettext(TEXT("CompeGPS Waypoint")),
			MB_OK|MB_ICONEXCLAMATION);
		return;
	} else 
	#endif
		if ( WayPointList[res].Format == LKW_VIRTUAL ) { // 100212
			MessageBoxX(hWndMapWindow, gettext(TEXT("This waypoint is read-only")),
				gettext(TEXT("VIRTUAL Waypoint")),
				MB_OK|MB_ICONEXCLAMATION);
			return;
		} else 
	#endif
	if(MessageBoxX(hWndMapWindow, WayPointList[res].Name, gettext(TEXT("Delete Waypoint?")), 
	MB_YESNO|MB_ICONQUESTION) == IDYES) {
		LockTaskData();
		WayPointList[res].FileNum = -1;
		UnlockTaskData();
		waypointneedsave = true;
	}
  }
}


static CallBackTableEntry_t CallBackTable[]={
  DeclareCallBackEntry(OnAirspaceColoursClicked),
  DeclareCallBackEntry(OnAirspaceModeClicked),
  DeclareCallBackEntry(OnUTCData),
  DeclareCallBackEntry(OnNextClicked),
  DeclareCallBackEntry(OnPrevClicked),
  DeclareCallBackEntry(OnSetupDeviceAClicked),
  DeclareCallBackEntry(OnSetupDeviceBClicked),
  DeclareCallBackEntry(OnInfoBoxHelp),
  DeclareCallBackEntry(OnWaypointNewClicked),
  DeclareCallBackEntry(OnWaypointDeleteClicked),
  DeclareCallBackEntry(OnWaypointEditClicked),
  DeclareCallBackEntry(OnWaypointSaveClicked),

  DeclareCallBackEntry(OnPolarFileData),
  DeclareCallBackEntry(OnPolarTypeData),

  DeclareCallBackEntry(OnDeviceAData),
  DeclareCallBackEntry(OnDeviceBData),

  DeclareCallBackEntry(OnUseCustomFontData),
  DeclareCallBackEntry(OnEditInfoWindowFontClicked),
  DeclareCallBackEntry(OnEditTitleWindowFontClicked),
  DeclareCallBackEntry(OnEditMapWindowFontClicked),
  DeclareCallBackEntry(OnEditTitleSmallWindowFontClicked),
  DeclareCallBackEntry(OnEditMapWindowBoldFontClicked),
  DeclareCallBackEntry(OnEditCDIWindowFontClicked),
  DeclareCallBackEntry(OnEditMapLabelFontClicked),
  DeclareCallBackEntry(OnEditStatisticsFontClicked),

  DeclareCallBackEntry(OnUserLevel),
  #if LKTOPO
  DeclareCallBackEntry(OnSetTopologyClicked),
  #endif
  DeclareCallBackEntry(OnSetCustomKeysClicked),
  DeclareCallBackEntry(NULL)
};


extern SCREEN_INFO Data_Options[];
extern int InfoType[];



static void SetInfoBoxSelector(int item, int mode)
{
  TCHAR name[80];
  InfoBoxPropName(name, item, mode);

  WndProperty *wp;
  wp = (WndProperty*)wf->FindByName(name);
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    for (int i=0; i<NUMSELECTSTRINGS; i++) {
      dfe->addEnumText(gettext(Data_Options[i].Description));
    }
    dfe->Sort(0);

    int it=0;
    
    switch(mode) {
    case 1: // climb
      it = (InfoType[item])& 0xff;
      break;
    case 0: // cruise
      it = (InfoType[item]>>8)& 0xff;
      break;
    case 2: // final glide
      it = (InfoType[item]>>16)& 0xff;
      break;
    case 3: // aux
      it = (InfoType[item]>>24)& 0xff;
      break;
    };
    dfe->Set(it);
    wp->RefreshDisplay();
  }
}


static void GetInfoBoxSelector(int item, int mode)
{
  TCHAR name[80];
  InfoBoxPropName(name, item, mode);
  WndProperty *wp;
  wp = (WndProperty*)wf->FindByName(name);
  if (wp) {
    int itnew = wp->GetDataField()->GetAsInteger();
    int it=0;
    
    switch(mode) {
    case 1: // climb
      it = (InfoType[item])& 0xff;
      break;
    case 0: // cruise
      it = (InfoType[item]>>8)& 0xff;
      break;
    case 2: // final glide
      it = (InfoType[item]>>16)& 0xff;
      break;
    case 3: // aux
      it = (InfoType[item]>>24)& 0xff;
      break;
    };

    if (it != itnew) {

      changed = true;

      switch(mode) {
      case 0: // cruise
	InfoType[item] &= 0xffff00ff;
	InfoType[item] += (itnew<<8);
	break;
      case 1: // climb
	InfoType[item] &= 0xffffff00;
	InfoType[item] += itnew;
	break;
      case 2: // final glide
	InfoType[item] &= 0xff00ffff;
	InfoType[item] += (itnew<<16);
	break;
      case 3: // aux
	InfoType[item] &= 0x00ffffff;
	InfoType[item] += (itnew<<24);
	break;
      };
      StoreType(item,InfoType[item]);
    }
  }
}

extern const TCHAR *PolarLabels[];

static  TCHAR szPolarFile[MAX_PATH] = TEXT("\0");
static  TCHAR szAirspaceFile[MAX_PATH] = TEXT("\0");
static  TCHAR szAdditionalAirspaceFile[MAX_PATH] = TEXT("\0");
static  TCHAR szWaypointFile[MAX_PATH] = TEXT("\0");
static  TCHAR szAdditionalWaypointFile[MAX_PATH] = TEXT("\0");
static  TCHAR szTerrainFile[MAX_PATH] = TEXT("\0");
static  TCHAR szTopologyFile[MAX_PATH] = TEXT("\0");
static  TCHAR szAirfieldFile[MAX_PATH] = TEXT("\0");
static  TCHAR szLanguageFile[MAX_PATH] = TEXT("\0");
static  TCHAR szStatusFile[MAX_PATH] = TEXT("\0");
static  TCHAR szInputFile[MAX_PATH] = TEXT("\0");
static  TCHAR szMapFile[MAX_PATH] = TEXT("\0");
static  DWORD dwPortIndex1 = 0;
static  DWORD dwSpeedIndex1 = 2;
static  DWORD dwBit1Index = (BitIndex_t)bit8N1;
static  DWORD dwPortIndex2 = 0;
static  DWORD dwSpeedIndex2 = 2;
static  DWORD dwBit2Index = (BitIndex_t)bit8N1;
static  int dwDeviceIndex1=0;
static  int dwDeviceIndex2=0;
static  TCHAR DeviceName[DEVNAMESIZE+1];
static  DWORD Speed = 2; // default is kmh 100219
static  DWORD TaskSpeed = 2; // default is kph
static  DWORD Distance = 2; // default is km
static  DWORD Lift = 1; // default m/s
static  DWORD Altitude = 1; //default m
static  TCHAR temptext[MAX_PATH];



static void setVariables(void) {
  WndProperty *wp;

  TCHAR tsuf[10]; // 091101
  buttonPilotName = ((WndButton *)wf->FindByName(TEXT("cmdPilotName")));
  if (buttonPilotName) {
    buttonPilotName->SetOnClickNotify(OnPilotNameClicked);
  }
  buttonAircraftType = ((WndButton *)wf->FindByName(TEXT("cmdAircraftType")));
  if (buttonAircraftType) {
    buttonAircraftType->SetOnClickNotify(OnAircraftTypeClicked);
  }
  buttonAircraftRego = ((WndButton *)wf->FindByName(TEXT("cmdAircraftRego")));
  if (buttonAircraftRego) {
    buttonAircraftRego->SetOnClickNotify(OnAircraftRegoClicked);
  }
  buttonLoggerID = ((WndButton *)wf->FindByName(TEXT("cmdLoggerID")));
  if (buttonLoggerID) {
    buttonLoggerID->SetOnClickNotify(OnLoggerIDClicked);
  }

  buttonCopy = ((WndButton *)wf->FindByName(TEXT("cmdCopy")));
  if (buttonCopy) {
    buttonCopy->SetOnClickNotify(OnCopy);
  }
  buttonPaste = ((WndButton *)wf->FindByName(TEXT("cmdPaste")));
  if (buttonPaste) {
    buttonPaste->SetOnClickNotify(OnPaste);
  }

  UpdateButtons();


  wp = (WndProperty*)wf->FindByName(TEXT("prpUserLevel"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Basic")));
    dfe->addEnumText(gettext(TEXT("Expert")));
    dfe->Set(UserLevel);
    wp->RefreshDisplay();
  }

// extended COM ports for PC
// Changing items requires also changing the i<13 loop later on for port1 and port2
#if (WINDOWSPC>0)
    const TCHAR *COMMPort[] = {TEXT("COM1"),TEXT("COM2"),TEXT("COM3"),TEXT("COM4"),
			       TEXT("COM5"),TEXT("COM6"),TEXT("COM7"),TEXT("COM8"),
			       TEXT("COM9"),TEXT("COM10"),TEXT("COM11"),TEXT("COM12"),TEXT("COM13"),TEXT("COM14"),
			       TEXT("COM15"),TEXT("COM16"),TEXT("COM17"),TEXT("COM18"),TEXT("COM19"),TEXT("COM20"),
			       TEXT("COM21"),TEXT("COM22"),TEXT("COM23"),TEXT("COM24"),TEXT("COM25"),TEXT("COM26"),
			       TEXT("COM27"),TEXT("COM28"),TEXT("COM29"),TEXT("COM30"),TEXT("COM31"),TEXT("COM32"),
				TEXT("COM0")};
#else
    const TCHAR *COMMPort[] = {TEXT("COM1"),TEXT("COM2"),TEXT("COM3"),TEXT("COM4"),
			       TEXT("COM5"),TEXT("COM6"),TEXT("COM7"),TEXT("COM8"),
			       TEXT("COM9"),TEXT("COM10"),TEXT("COM0"),TEXT("VSP0"),TEXT("VSP1")};
#endif
    const TCHAR *tSpeed[] = {TEXT("1200"),TEXT("2400"),TEXT("4800"),TEXT("9600"),
			     TEXT("19200"),TEXT("38400"),TEXT("57600"),TEXT("115200")};
//  DWORD dwSpeed[] = {1200,2400,4800,9600,19200,38400,57600,115200};

  int i;

  ReadPort1Settings(&dwPortIndex1,&dwSpeedIndex1, &dwBit1Index);

  wp = (WndProperty*)wf->FindByName(TEXT("prpComPort1"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
#if (WINDOWSPC>0)
    for (i=0; i<33; i++) { // 091117
#else
    for (i=0; i<13; i++) {
#endif
      dfe->addEnumText((COMMPort[i]));
    }
    dfe->Set(dwPortIndex1);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComSpeed1"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    for (i=0; i<8; i++) {
      dfe->addEnumText((tSpeed[i]));
    }
    dfe->Set(dwSpeedIndex1);
    wp->RefreshDisplay();
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpComBit1"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(TEXT("8bit"));
    dfe->addEnumText(TEXT("7bit"));
    dfe->Set(dwBit1Index);
    wp->RefreshDisplay();
  }

  TCHAR deviceName1[MAX_PATH];
  TCHAR deviceName2[MAX_PATH];
  ReadDeviceSettings(0, deviceName1);
  ReadDeviceSettings(1, deviceName2);

  wp = (WndProperty*)wf->FindByName(TEXT("prpComDevice1"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    for (i=0; i<DeviceRegisterCount; i++) {
      devRegisterGetName(i, DeviceName);
      dfe->addEnumText((DeviceName));

      if (_tcscmp(DeviceName, deviceName1) == 0)
        dwDeviceIndex1 = i;

    }
    dfe->Sort(1);
    dfe->Set(dwDeviceIndex1);
    wp->RefreshDisplay();
  }

  ReadPort2Settings(&dwPortIndex2,&dwSpeedIndex2, &dwBit2Index);

  wp = (WndProperty*)wf->FindByName(TEXT("prpComPort2"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
#if (WINDOWSPC>0)
    for (i=0; i<33; i++) { // 091117
#else
    for (i=0; i<13; i++) {
#endif
      dfe->addEnumText((COMMPort[i]));
    }
    dfe->Set(dwPortIndex2);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComSpeed2"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    for (i=0; i<8; i++) {
      dfe->addEnumText((tSpeed[i]));
    }
    dfe->Set(dwSpeedIndex2);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComBit2"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(TEXT("8bit"));
    dfe->addEnumText(TEXT("7bit"));
    dfe->Set(dwBit2Index);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComDevice2"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    for (i=0; i<DeviceRegisterCount; i++) {
      devRegisterGetName(i, DeviceName);
      dfe->addEnumText((DeviceName));
      if (_tcscmp(DeviceName, deviceName2) == 0)
        dwDeviceIndex2 = i;
    }
    dfe->Sort(1);
    dfe->Set(dwDeviceIndex2);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAirspaceDisplay"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("All on")));
    dfe->addEnumText(gettext(TEXT("Clip")));
    dfe->addEnumText(gettext(TEXT("Auto")));
    dfe->addEnumText(gettext(TEXT("All below")));
    dfe->Set(AltitudeMode);
    wp->RefreshDisplay();
  }
  // 
  wp = (WndProperty*)wf->FindByName(TEXT("prpSafetyAltitudeMode"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Landables only")));
    dfe->addEnumText(gettext(TEXT("Landables and Turnpoints")));
    dfe->Set(SafetyAltitudeMode);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUTCOffset"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(UTCOffset/1800.0)/2.0);
    wp->RefreshDisplay();
  }
  SetLocalTime();

  wp = (WndProperty*)wf->FindByName(TEXT("prpClipAltitude"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(ClipAltitude*ALTITUDEMODIFY));
    wp->GetDataField()->SetUnits(Units::GetAltitudeName());
    wp->RefreshDisplay();
  }
    
  wp = (WndProperty*)wf->FindByName(TEXT("prpAltWarningMargin"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(AltWarningMargin*ALTITUDEMODIFY));
    wp->GetDataField()->SetUnits(Units::GetAltitudeName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoZoom"));
  if (wp) {
    wp->GetDataField()->Set(MapWindow::AutoZoom);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAirspaceOutline"));
  if (wp) {
    wp->GetDataField()->Set(MapWindow::bAirspaceBlackOutline);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLockSettingsInFlight"));
  if (wp) {
    wp->GetDataField()->Set(LockSettingsInFlight);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLoggerShortName"));
  if (wp) {
    wp->GetDataField()->Set(LoggerShortName);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpDebounceTimeout"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(debounceTimeout);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableFLARMMap"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("OFF")));
    dfe->addEnumText(gettext(TEXT("ON/Fixed")));
    dfe->addEnumText(gettext(TEXT("ON/Scaled")));
    dfe->Set(EnableFLARMMap);
    wp->RefreshDisplay();
  }

  #if 0 
  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableFLARMGauge"));
  if (wp) {
    wp->GetDataField()->Set(EnableFLARMGauge);
    wp->RefreshDisplay();
  }
  #endif

  wp = (WndProperty*)wf->FindByName(TEXT("prpAirspaceWarnings"));
  if (wp) {
    bool aw = AIRSPACEWARNINGS != 0;
    wp->GetDataField()->Set(aw);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWarningTime"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(WarningTime);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAcknowledgementTime"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(AcknowledgementTime);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWaypointLabels"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Names")));
    dfe->addEnumText(gettext(TEXT("Numbers")));
    dfe->addEnumText(gettext(TEXT("First 5")));
    dfe->addEnumText(gettext(TEXT("None")));
    dfe->addEnumText(gettext(TEXT("First 3")));
    dfe->addEnumText(gettext(TEXT("Names in task")));
    dfe->Set(DisplayTextType);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableTerrain"));
  if (wp) {
    wp->GetDataField()->Set(EnableTerrain);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableTopology"));
  if (wp) {
    wp->GetDataField()->Set(EnableTopology);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpCirclingZoom"));
  if (wp) {
    wp->GetDataField()->Set(CircleZoom);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpOrientation"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Track up")));
    dfe->addEnumText(gettext(TEXT("North up")));
    dfe->addEnumText(gettext(TEXT("North circling")));
    dfe->addEnumText(gettext(TEXT("Target circling")));
    dfe->addEnumText(gettext(TEXT("North/track")));
    dfe->addEnumText(gettext(TEXT("North Smart"))); // 100417
    #if AUTORIENT
    dfe->Set(OldDisplayOrientation);
    #else
    dfe->Set(DisplayOrientation);
    #endif
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpMenuTimeout"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(MenuTimeoutMax/2);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpSafetyAltitudeArrival"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(ALTITUDEMODIFY*SAFETYALTITUDEARRIVAL));
    wp->GetDataField()->SetUnits(Units::GetAltitudeName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpSafetyAltitudeBreakoff"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(ALTITUDEMODIFY*SAFETYALTITUDEBREAKOFF));
    wp->GetDataField()->SetUnits(Units::GetAltitudeName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpSafetyAltitudeTerrain"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(ALTITUDEMODIFY*SAFETYALTITUDETERRAIN));
    wp->GetDataField()->SetUnits(Units::GetAltitudeName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpFinalGlideTerrain"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("OFF")));
    dfe->addEnumText(gettext(TEXT("Line")));
    dfe->addEnumText(gettext(TEXT("Shade")));
    dfe->Set(FinalGlideTerrain);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableNavBaroAltitude"));
  if (wp) {
    wp->GetDataField()->Set(EnableNavBaroAltitude);
    wp->RefreshDisplay();
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpOrbiter"));
  if (wp) {
    wp->GetDataField()->Set(Orbiter);
    wp->RefreshDisplay();
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpShading"));
  if (wp) {
    wp->GetDataField()->Set(Shading);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWindArrowStyle"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Arrow head")));
    dfe->addEnumText(gettext(TEXT("Full arrow")));
    wp->GetDataField()->Set(MapWindow::WindArrowStyle);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoWind"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Manual")));
    dfe->addEnumText(gettext(TEXT("Circling")));
    dfe->addEnumText(gettext(TEXT("ZigZag")));
    dfe->addEnumText(gettext(TEXT("Both")));
    wp->GetDataField()->Set(AutoWindMode);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoMcMode"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Final glide")));
    dfe->addEnumText(gettext(TEXT("Average climb")));
    dfe->addEnumText(gettext(TEXT("Both (Fin+Ave)")));
    #if EQMC
    dfe->addEnumText(gettext(TEXT("Equivalent MC")));
    #endif
    wp->GetDataField()->Set(AutoMcMode);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWaypointsOutOfRange"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Ask")));
    dfe->addEnumText(gettext(TEXT("Include")));
    dfe->addEnumText(gettext(TEXT("Exclude")));
    wp->GetDataField()->Set(WaypointsOutOfRange);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoForceFinalGlide"));
  if (wp) {
    wp->GetDataField()->Set(AutoForceFinalGlide);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpBlockSTF"));
  if (wp) {
    wp->GetDataField()->Set(EnableBlockSTF);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpFAIFinishHeight"));
  if (wp) {
    wp->GetDataField()->Set(EnableFAIFinishHeight);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpOLCRules"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Sprint")));
    dfe->addEnumText(gettext(TEXT("Triangle")));
    dfe->addEnumText(gettext(TEXT("Classic")));
    dfe->Set(OLCRules);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpHandicap"));
  if (wp) {
    wp->GetDataField()->SetAsInteger(Handicap);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpPGClimbZoom"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("More")));
    dfe->addEnumText(gettext(TEXT("Standard")));
    dfe->addEnumText(gettext(TEXT("Less")));
    dfe->addEnumText(gettext(TEXT("Lower")));
    dfe->addEnumText(gettext(TEXT("Higher")));
    dfe->Set(PGClimbZoom);
    // if (!ISPARAGLIDER) wp->SetVisible(false); 
    wp->RefreshDisplay();
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpPGCruiseZoom"));
  if (wp) {
    wp->GetDataField()->SetAsInteger(PGCruiseZoom);
    // if (!ISPARAGLIDER) wp->SetVisible(false); 
    wp->RefreshDisplay();
  }
  #if AUTORIENT
  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoOrientScale"));
  if (wp) {
    wp->GetDataField()->SetAsInteger(AutoOrientScale);
    wp->RefreshDisplay();
  }
  #endif

  wp = (WndProperty*)wf->FindByName(TEXT("prpPGNumberOfGates"));
  if (wp) {
    wp->GetDataField()->SetAsInteger(PGNumberOfGates);
    wp->RefreshDisplay();
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpPGOpenTimeH"));
  if (wp) {
    wp->GetDataField()->SetAsInteger(PGOpenTimeH);
    wp->RefreshDisplay();
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpPGOpenTimeM"));
  if (wp) {
    wp->GetDataField()->SetAsInteger(PGOpenTimeM);
    // if (PGNumberOfGates==0) wp->SetReadOnly(true);
    wp->RefreshDisplay();
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpPGGateIntervalTime"));
  if (wp) {
    wp->GetDataField()->SetAsInteger(PGGateIntervalTime);
    wp->RefreshDisplay();
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpPGStartOut"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("IN (Exit)")));
    dfe->addEnumText(gettext(TEXT("OUT (Enter)")));
    dfe->Set(PGStartOut);
    wp->RefreshDisplay();
  }
  

  if(GetFromRegistry(szRegistrySpeedUnitsValue,&Speed)!=ERROR_SUCCESS) {
    SetToRegistry(szRegistrySpeedUnitsValue, Speed);
    changed = true;
  } 
  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsSpeed"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Statute")));
    dfe->addEnumText(gettext(TEXT("Nautical")));
    dfe->addEnumText(gettext(TEXT("Metric")));
    dfe->Set(Speed);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsLatLon"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(TEXT("DDMMSS"));
    dfe->addEnumText(TEXT("DDMMSS.ss"));
    dfe->addEnumText(TEXT("DDMM.mmm"));
    dfe->addEnumText(TEXT("DD.dddd"));
#ifdef NEWUTM
    dfe->addEnumText(TEXT("UTM"));
#endif
    dfe->Set(Units::CoordinateFormat);
    wp->RefreshDisplay();
  }

  if(GetFromRegistry(szRegistryTaskSpeedUnitsValue,&TaskSpeed)!=ERROR_SUCCESS) {
    SetToRegistry(szRegistryTaskSpeedUnitsValue, TaskSpeed);
    changed = true;
  } 
  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsTaskSpeed"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Statute")));
    dfe->addEnumText(gettext(TEXT("Nautical")));
    dfe->addEnumText(gettext(TEXT("Metric")));
    dfe->Set(TaskSpeed);
    wp->RefreshDisplay();
  }

  if(GetFromRegistry(szRegistryDistanceUnitsValue,&Distance)!=ERROR_SUCCESS) {
    SetToRegistry(szRegistryDistanceUnitsValue, Distance);
    changed = true;
  } 
  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsDistance"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Statute")));
    dfe->addEnumText(gettext(TEXT("Nautical")));
    dfe->addEnumText(gettext(TEXT("Metric")));
    dfe->Set(Distance);
    wp->RefreshDisplay();
  }

  if(GetFromRegistry(szRegistryAltitudeUnitsValue,&Altitude)!=ERROR_SUCCESS) {
    SetToRegistry(szRegistryAltitudeUnitsValue, Altitude);
    changed = true;
  } 
  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsAltitude"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("feet")));
    dfe->addEnumText(gettext(TEXT("meters")));
    dfe->Set(Altitude);
    wp->RefreshDisplay();
  }

  if(GetFromRegistry(szRegistryLiftUnitsValue,&Lift)!=ERROR_SUCCESS) {
    SetToRegistry(szRegistryLiftUnitsValue, Lift);
    changed = true;
  } 
  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsLift"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("knots")));
    dfe->addEnumText(gettext(TEXT("m/s")));
    dfe->Set(Lift);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTrailDrift"));
  if (wp) {
    wp->GetDataField()->Set(MapWindow::EnableTrailDrift);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpThermalLocator"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("OFF")));
    dfe->addEnumText(gettext(TEXT("Mark center")));
    dfe->addEnumText(gettext(TEXT("Pan to center")));
    dfe->Set(EnableThermalLocator);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpSetSystemTimeFromGPS"));
  if (wp) {
    wp->GetDataField()->Set(SetSystemTimeFromGPS);
    wp->RefreshDisplay();
  }


  wp = (WndProperty*)wf->FindByName(TEXT("prpAbortSafetyUseCurrent"));
  if (wp) {
    wp->GetDataField()->Set(GlidePolar::AbortSafetyUseCurrent);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpDisableAutoLogger"));
  if (wp) {
    wp->GetDataField()->Set(!DisableAutoLogger);
    wp->RefreshDisplay();
  }


  wp = (WndProperty*)wf->FindByName(TEXT("prpSafetyMacCready"));
  if (wp) {
    wp->GetDataField()->Set(GlidePolar::SafetyMacCready*LIFTMODIFY);
    wp->GetDataField()->SetUnits(Units::GetVerticalSpeedName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpRiskGamma"));
  if (wp) {
    wp->GetDataField()->Set(GlidePolar::RiskGamma);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAnimation"));
  if (wp) {
    wp->GetDataField()->Set(EnableAnimation);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTrail"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Off")));
    dfe->addEnumText(gettext(TEXT("Long")));
    dfe->addEnumText(gettext(TEXT("Short")));
    dfe->addEnumText(gettext(TEXT("Full")));
    dfe->Set(TrailActive);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLKMaxLabels"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(LKMaxLabels);
    wp->RefreshDisplay();
  }

  // VENTA3 VisualGlide
  wp = (WndProperty*)wf->FindByName(TEXT("prpVGlide"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Off")));
    dfe->addEnumText(gettext(TEXT("Steady")));
    dfe->addEnumText(gettext(TEXT("Moving")));
    dfe->Set(VisualGlide);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpMaxManoeuveringSpeed"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(SPEEDMODIFY*SAFTEYSPEED));
    wp->GetDataField()->SetUnits(Units::GetHorizontalSpeedName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWindCalcSpeed")); // 100112
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(SPEEDMODIFY*WindCalcSpeed));
    wp->GetDataField()->SetUnits(Units::GetHorizontalSpeedName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWindCalcTime")); // 100113
  if (wp) {
    wp->GetDataField()->Set(WindCalcTime);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpBallastSecsToEmpty"));
  if (wp) {
    wp->GetDataField()->Set(BallastSecsToEmpty);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpPolarType"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    for (i=0; i<NUMPOLARS; i++) {
      dfe->addEnumText(PolarLabels[i]);
    }
    i=0;
    bool ok = true;
    while (ok) {
      TCHAR *name;
      name = GetWinPilotPolarInternalName(i);
      if (!name) {
	ok=false;
      } else {
	dfe->addEnumText(name);
      }
      i++;
    }
    dfe->Sort();
    dfe->Set(POLARID);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryPolarFile, szPolarFile, MAX_PATH);
  _tcscpy(temptext,szPolarFile);
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpPolarFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_POLARS);
    dfe->ScanDirectoryTop(_T(LKD_POLARS),tsuf); //091101
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryAirspaceFile, szAirspaceFile, MAX_PATH);
  _tcscpy(temptext,szAirspaceFile);
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpAirspaceFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_AIRSPACES);
    dfe->ScanDirectoryTop(_T(LKD_AIRSPACES),tsuf);
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryAdditionalAirspaceFile, 
		    szAdditionalAirspaceFile, MAX_PATH);
  _tcscpy(temptext,szAdditionalAirspaceFile);
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpAdditionalAirspaceFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_AIRSPACES);
    dfe->ScanDirectoryTop(_T(LKD_AIRSPACES),tsuf);
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryWayPointFile, szWaypointFile, MAX_PATH);
  _tcscpy(temptext,szWaypointFile);
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpWaypointFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_WP_WINPILOT);
    dfe->ScanDirectoryTop(_T(LKD_WAYPOINTS),tsuf);
    _stprintf(tsuf,_T("*%S"),LKS_WP_XCSOAR);
    dfe->ScanDirectoryTop(_T(LKD_WAYPOINTS),tsuf);
#ifdef CUPSUP
    _stprintf(tsuf,_T("*%S"),LKS_WP_CUP);
    dfe->ScanDirectoryTop(_T(LKD_WAYPOINTS),tsuf);
    _stprintf(tsuf,_T("*%S"),LKS_WP_COMPE);
    dfe->ScanDirectoryTop(_T(LKD_WAYPOINTS),tsuf);
#endif
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryAdditionalWayPointFile, 
		    szAdditionalWaypointFile, MAX_PATH);
  _tcscpy(temptext,szAdditionalWaypointFile);
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpAdditionalWaypointFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_WP_WINPILOT);
    dfe->ScanDirectoryTop(_T(LKD_WAYPOINTS),tsuf);
    _stprintf(tsuf,_T("*%S"),LKS_WP_XCSOAR);
    dfe->ScanDirectoryTop(_T(LKD_WAYPOINTS),tsuf);
#ifdef CUPSUP
    _stprintf(tsuf,_T("*%S"),LKS_WP_CUP);
    dfe->ScanDirectoryTop(_T(LKD_WAYPOINTS),tsuf);
    _stprintf(tsuf,_T("*%S"),LKS_WP_COMPE);
    dfe->ScanDirectoryTop(_T(LKD_WAYPOINTS),tsuf);
#endif
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryMapFile, szMapFile, MAX_PATH);
  _tcscpy(temptext,szMapFile);
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpMapFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_MAPS);
    dfe->ScanDirectoryTop(_T(LKD_MAPS),tsuf);
    _stprintf(tsuf,_T("*%S"),XCS_MAPS);
    dfe->ScanDirectoryTop(_T(LKD_MAPS),tsuf);
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryTerrainFile, szTerrainFile, MAX_PATH);
  _tcscpy(temptext,szTerrainFile);
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpTerrainFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_TERRAINDEM);
    dfe->ScanDirectoryTop(_T(LKD_MAPS),tsuf);
    _stprintf(tsuf,_T("*%S"),LKS_TERRAINDAT);
    dfe->ScanDirectoryTop(_T(LKD_MAPS),tsuf);
    _stprintf(tsuf,_T("*%S"),LKS_TERRAINJP2);
    dfe->ScanDirectoryTop(_T(LKD_MAPS),tsuf);
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryTopologyFile, szTopologyFile, MAX_PATH);
  _tcscpy(temptext,szTopologyFile);
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpTopologyFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_TOPOLOGY);
    dfe->ScanDirectoryTop(_T(LKD_MAPS),tsuf);
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryAirfieldFile, szAirfieldFile, MAX_PATH);
  _tcscpy(temptext,szAirfieldFile);
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpAirfieldFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_AIRFIELDS);
    dfe->ScanDirectoryTop(_T(LKD_WAYPOINTS),tsuf);
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryLanguageFile, szLanguageFile, MAX_PATH);
  _tcscpy(temptext,szLanguageFile);
  if (_tcslen(temptext)==0) {
	_tcscpy(temptext,_T("%LOCAL_PATH%\\\\_Language\\ENGLISH.LNG"));
  }
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpLanguageFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_LANGUAGE);
    dfe->ScanDirectoryTop(_T(LKD_LANGUAGE),tsuf);
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryStatusFile, szStatusFile, MAX_PATH);
  _tcscpy(temptext,szStatusFile);
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpStatusFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_STATUS);
    dfe->ScanDirectoryTop(_T(LKD_CONF),tsuf);
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  GetRegistryString(szRegistryInputFile, szInputFile, MAX_PATH);
  _tcscpy(temptext,szInputFile);
  ExpandLocalPath(temptext);
  wp = (WndProperty*)wf->FindByName(TEXT("prpInputFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _stprintf(tsuf,_T("*%S"),LKS_INPUT);
    dfe->ScanDirectoryTop(_T(LKD_CONF),tsuf);
    dfe->Lookup(temptext);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppStatusMessageAlignment"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Center")));
    dfe->addEnumText(gettext(TEXT("Topleft")));
    dfe->Set(Appearance.StateMessageAlligne);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTextInput"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("HighScore Style")));
    dfe->addEnumText(gettext(TEXT("Keyboard")));
	dfe->Set(Appearance.TextInputStyle);
    wp->RefreshDisplay();
  }



  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInfoBoxBorder"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Box")));
    dfe->addEnumText(gettext(TEXT("Tab")));
    dfe->Set(Appearance.InfoBoxBorder);
    wp->RefreshDisplay();
  }

#if defined(PNA) || defined(FIVV)
// VENTA-ADDON Geometry change config menu 11
  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInfoBoxGeom"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();

    if (InfoBoxLayout::landscape) {

	
	dfe->addEnumText(TEXT("vario+9box")); // 0
	dfe->addEnumText(TEXT("(empty) A"));  // 1 
	dfe->addEnumText(TEXT("(empty) B"));  // 2 
	dfe->addEnumText(TEXT("(empty) C"));  // 3
	dfe->addEnumText(TEXT("8box left"));  // 4
	dfe->addEnumText(TEXT("8box right")); // 5
	dfe->addEnumText(TEXT("(empty) D"));  // 6
	dfe->addEnumText(TEXT("5box right")); // 7
	dfe->Set(Appearance.InfoBoxGeom);
	wp->RefreshDisplay();

    } else { 
	dfe->addEnumText(TEXT("top+bottom")); // 0
	dfe->addEnumText(TEXT("bottom"));     // 1
	dfe->addEnumText(TEXT("top"));        // 2 
	dfe->addEnumText(TEXT("3 free")); // 3
	dfe->addEnumText(TEXT("4 free"));       // 4
	dfe->addEnumText(TEXT("5 free"));      // 5
	dfe->addEnumText(TEXT("6 free"));      // 6
	dfe->addEnumText(TEXT("7"));          // 7
	dfe->Set(Appearance.InfoBoxGeom);
	wp->RefreshDisplay();

    }
  }
//
#endif

#ifdef PNA
// VENTA-ADDON Model change config menu 11
  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInfoBoxModel"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(TEXT("Generic"));
    dfe->addEnumText(TEXT("HP31x"));
    dfe->addEnumText(TEXT("MedionP5"));
    dfe->addEnumText(TEXT("MIO"));
    dfe->addEnumText(TEXT("Nokia500")); // VENTA3
    dfe->addEnumText(TEXT("PN6000"));
    dfe->addEnumText(TEXT("Navigon"));
	
	int iTmp;
	switch (GlobalModelType) {
		case MODELTYPE_PNA_PNA:
				iTmp=(InfoBoxModelAppearance_t)apImPnaGeneric;
				break;
		case MODELTYPE_PNA_HP31X:
				iTmp=(InfoBoxModelAppearance_t)apImPnaHp31x;
				break;
		case MODELTYPE_PNA_PN6000:
				iTmp=(InfoBoxModelAppearance_t)apImPnaPn6000;
				break;
		case MODELTYPE_PNA_MIO:
				iTmp=(InfoBoxModelAppearance_t)apImPnaMio;
				break;
		case MODELTYPE_PNA_NOKIA_500:
				iTmp=(InfoBoxModelAppearance_t)apImPnaNokia500;
				break;
		case MODELTYPE_PNA_MEDION_P5:
				iTmp=(InfoBoxModelAppearance_t)apImPnaMedionP5;
				break;
		case MODELTYPE_PNA_NAVIGON:
				iTmp=(InfoBoxModelAppearance_t)apImPnaNavigon;
				break;
		default:
				iTmp=(InfoBoxModelAppearance_t)apImPnaGeneric;
				break;
	}

    dfe->Set(iTmp);
    wp->RefreshDisplay();
  }
#elif defined FIVV
  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInfoBoxModel"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
// VENTA2- PC model
#if (WINDOWSPC>0)
    dfe->addEnumText(gettext(TEXT("PC/normal")));
    #ifdef FIVV
   	 wp->SetVisible(true); // no more gaps in menus
    #else
   	 wp->SetVisible(false); // currently no need to display default
    #endif
#else
    dfe->addEnumText(gettext(TEXT("PDA/normal")));
    #ifdef FIVV
    wp->SetVisible(true);
    #else
    wp->SetVisible(false);
    #endif
#endif
        dfe->Set(0);
    wp->RefreshDisplay();
  }
#endif

  wp = (WndProperty*)wf->FindByName(TEXT("prpAircraftCategory"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Glider")));
    dfe->addEnumText(gettext(TEXT("Paraglider/Delta")));
    dfe->addEnumText(gettext(TEXT("Car")));
    dfe->addEnumText(gettext(TEXT("GA Aircraft")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(AircraftCategory);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpExtendedVisualGlide"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Normal")));
    dfe->addEnumText(gettext(TEXT("Extended")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(ExtendedVisualGlide);
    wp->RefreshDisplay();
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpLook8000"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField(); 
     dfe->addEnumText(TEXT("(Reserved)"));
     dfe->addEnumText(gettext(TEXT("No overlay"))); // 091115
     dfe->addEnumText(gettext(TEXT("Half overlay")));
    	dfe->addEnumText(gettext(TEXT("Full overlay")));
     dfe = (DataFieldEnum*)wp->GetDataField(); // see above
     dfe->Set(Look8000);
    wp->RefreshDisplay();
  }

#if (0)
  wp = (WndProperty*)wf->FindByName(TEXT("prpAltArrivMode"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
     dfe->addEnumText(gettext(TEXT("Use MacCready")));
     dfe->addEnumText(gettext(TEXT("Always use MC=0")));
     dfe->addEnumText(gettext(TEXT("Always use safety MC")));
     dfe->addEnumText(gettext(TEXT("Use aver.efficiency")));
     dfe = (DataFieldEnum*)wp->GetDataField();
     dfe->Set(AltArrivMode);
    wp->RefreshDisplay();
  }
#endif

  wp = (WndProperty*)wf->FindByName(TEXT("prpNewMap"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(NewMap);
    wp->RefreshDisplay();
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpCheckSum"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(CheckSum);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpIphoneGestures"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Inverted")));
    dfe->addEnumText(gettext(TEXT("Normal")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(IphoneGestures);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpPollingMode"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Normal")));
    dfe->addEnumText(gettext(TEXT("Polling")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(PollingMode);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLKVarioBar"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Vario rainbow")));
    dfe->addEnumText(gettext(TEXT("Vario black")));
    dfe->addEnumText(gettext(TEXT("Vario red+blue")));
    dfe->addEnumText(gettext(TEXT("Vario green+red")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(LKVarioBar);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpHideUnits"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(HideUnits);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpDeclutterMode"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Low")));
    dfe->addEnumText(gettext(TEXT("Medium")));
    dfe->addEnumText(gettext(TEXT("High")));
    dfe->addEnumText(gettext(TEXT("Very High")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(DeclutterMode);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpVirtualKeys"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(VirtualKeys);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUseMapLock"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(UseMapLock);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpActiveMap")); // 100318
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(ActiveMap);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpBestWarning")); // 091122
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(BestWarning);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpThermalBar")); // 091122
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(ThermalBar);
    wp->RefreshDisplay();
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpOverlayClock"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(OverlayClock);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpMcOverlay")); // 091122
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(McOverlay);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTrackBar")); // 091122
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(TrackBar);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpOutlinedTp"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("All black")));
    dfe->addEnumText(gettext(TEXT("Values white")));
    dfe->addEnumText(gettext(TEXT("All white")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(OutlinedTp);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTpFilter"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("No landables")));
    dfe->addEnumText(gettext(TEXT("All waypoints")));
    dfe->addEnumText(gettext(TEXT("DAT Turnpoints")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(TpFilter);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpOverColor"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("White")));
    dfe->addEnumText(gettext(TEXT("Black")));
    dfe->addEnumText(gettext(TEXT("DarkBlue")));
    dfe->addEnumText(gettext(TEXT("Yellow")));
    dfe->addEnumText(gettext(TEXT("Green")));
    dfe->addEnumText(gettext(TEXT("Orange")));
    dfe->addEnumText(gettext(TEXT("Cyan")));
    dfe->addEnumText(gettext(TEXT("Magenta")));
    dfe->addEnumText(gettext(TEXT("Grey")));
    dfe->addEnumText(gettext(TEXT("Dark Grey")));
    dfe->addEnumText(gettext(TEXT("Dark White")));
    dfe->addEnumText(gettext(TEXT("Amber")));
    dfe->addEnumText(gettext(TEXT("Light Green")));
    dfe->addEnumText(gettext(TEXT("Petrol")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(OverColor);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpMapBox"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Unboxed, no units")));
    dfe->addEnumText(gettext(TEXT("Unboxed, with units")));
    dfe->addEnumText(gettext(TEXT("Boxed, no units")));
    dfe->addEnumText(gettext(TEXT("Boxed, with units")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(MapBox);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpGlideBarMode"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Next turnpoint")));
    dfe->addEnumText(gettext(TEXT("Finish")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(GlideBarMode);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpArrivalValue"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("ArrivalAltitude")));
    dfe->addEnumText(gettext(TEXT("EfficiencyReq")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(ArrivalValue);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpNewMapDeclutter"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Low")));
    dfe->addEnumText(gettext(TEXT("High")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(NewMapDeclutter);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAverEffTime"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("15 seconds")));
    dfe->addEnumText(gettext(TEXT("30 seconds")));
    dfe->addEnumText(gettext(TEXT("60 seconds")));
    dfe->addEnumText(gettext(TEXT("90 seconds")));
    dfe->addEnumText(gettext(TEXT("2 minutes")));
    dfe->addEnumText(gettext(TEXT("3 minutes")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(AverEffTime);
    wp->RefreshDisplay();
 }

  wp = (WndProperty*)wf->FindByName(TEXT("prpBgMapcolor"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("White")));
    dfe->addEnumText(gettext(TEXT("Light grey")));
    dfe->addEnumText(gettext(TEXT("LCD green")));
    dfe->addEnumText(gettext(TEXT("LCD darkgreen")));
    dfe->addEnumText(gettext(TEXT("Grey")));
    dfe->addEnumText(gettext(TEXT("Blue lake")));
    dfe->addEnumText(gettext(TEXT("Emerald green")));
    dfe->addEnumText(gettext(TEXT("Dark grey")));
    dfe->addEnumText(gettext(TEXT("Rifle grey")));
    dfe->addEnumText(gettext(TEXT("Black")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(BgMapColor);
    wp->RefreshDisplay();
 }

// Fonts
  wp = (WndProperty*)wf->FindByName(TEXT("prpUseCustomFonts"));
  if (wp) {
    DataFieldBoolean * dfb = (DataFieldBoolean*) wp->GetDataField();
    dfb->Set(UseCustomFonts);
    ShowFontEditButtons(dfb->GetAsBoolean());
    wp->RefreshDisplay();
    RefreshFonts();
  }
  FontRegistryChanged=false;


// end fonts

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppCompassAppearance"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Normal")));
    dfe->addEnumText(gettext(TEXT("White outline")));
    dfe->Set(Appearance.CompassAppearance);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppIndFinalGlide"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Default")));
    dfe->addEnumText(gettext(TEXT("Alternate")));
    dfe->Set(Appearance.IndFinalGlide);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppIndLandable"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Winpilot")));
    dfe->addEnumText(gettext(TEXT("Alternate")));
    dfe->Set(Appearance.IndLandable);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableExternalTriggerCruise"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("OFF")));
    dfe->addEnumText(gettext(TEXT("Flap")));
    dfe->addEnumText(gettext(TEXT("SC")));
    dfe->Set(EnableExternalTriggerCruise);
    wp->RefreshDisplay();
  }

  #if 100922
  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInverseInfoBox"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("ON")));
    dfe->addEnumText(gettext(TEXT("OFF")));
    dfe->Set(Appearance.InverseInfoBox);
    wp->RefreshDisplay();
  }
  #else
  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInverseInfoBox"));
  if (wp) {
    wp->GetDataField()->Set(Appearance.InverseInfoBox);
    wp->RefreshDisplay();
  }
  #endif

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppDefaultMapWidth"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(Appearance.DefaultMapWidth);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpGliderScreenPosition"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(MapWindow::GliderScreenPosition);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTerrainContrast"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(TerrainContrast*100/255));
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTerrainBrightness"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(TerrainBrightness*100/255));
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTerrainRamp"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Low lands")));
    dfe->addEnumText(gettext(TEXT("Mountainous")));
    dfe->addEnumText(TEXT("Imhof 7"));
    dfe->addEnumText(TEXT("Imhof 4"));
    dfe->addEnumText(TEXT("Imhof 12"));
    dfe->addEnumText(TEXT("Imhof Atlas"));
    dfe->addEnumText(TEXT("ICAO")); 
    dfe->addEnumText(gettext(TEXT("LKoogle lowlands"))); 
    dfe->addEnumText(gettext(TEXT("LKoogle mountains")));
    dfe->addEnumText(gettext(TEXT("Low Alps")));
    dfe->addEnumText(gettext(TEXT("High Alps")));
    dfe->addEnumText(TEXT("YouSee"));
    dfe->addEnumText(gettext(TEXT("HighContrast")));
    dfe->Set(TerrainRamp);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInfoBoxColors"));
  if (wp) {
    wp->GetDataField()->Set(Appearance.InfoBoxColors);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppAveNeedle"));
  if (wp) {
    wp->GetDataField()->Set(Appearance.GaugeVarioAveNeedle);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioSpeedToFly"));
  if (wp) {
    wp->GetDataField()->Set(Appearance.GaugeVarioSpeedToFly);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioAvgText"));
  if (wp) {
    wp->GetDataField()->Set(Appearance.GaugeVarioAvgText);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioGross"));
  if (wp) {
    wp->GetDataField()->Set(Appearance.GaugeVarioGross);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioMc"));
  if (wp) {
    wp->GetDataField()->Set(Appearance.GaugeVarioMc);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioBugs"));
  if (wp) {
    wp->GetDataField()->Set(Appearance.GaugeVarioBugs);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioBallast"));
  if (wp) {
    wp->GetDataField()->Set(Appearance.GaugeVarioBallast);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoBlank"));
  if (wp) {
#ifdef GNAV
    wp->SetVisible(false);
#endif
#if (WINDOWSPC>0)
    wp->SetVisible(false);
#endif
    wp->GetDataField()->Set(EnableAutoBlank);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoBacklight")); // VENTA4
  if (wp) {
    wp->SetVisible(true); // 091115 changed to true
#ifdef PNA
    if (GlobalModelType == MODELTYPE_PNA_HP31X )
    	wp->SetVisible(true);
#endif
    wp->GetDataField()->Set(EnableAutoBacklight);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoSoundVolume")); // VENTA4
  if (wp) {
    wp->SetVisible(true); // 091115 changed to true
#if ( !defined(WINDOWSPC) || WINDOWSPC==0 )
    	wp->SetVisible(true);
#endif
    wp->GetDataField()->Set(EnableAutoSoundVolume);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskFinishLine"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Cylinder")));
    dfe->addEnumText(gettext(TEXT("Line")));
    dfe->addEnumText(gettext(TEXT("FAI Sector")));
    dfe->Set(FinishLine);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskFinishRadius"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(lround(FinishRadius*DISTANCEMODIFY*DISTANCE_ROUNDING)/DISTANCE_ROUNDING);
    wp->GetDataField()->SetUnits(Units::GetDistanceName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskStartLine"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Cylinder")));
    dfe->addEnumText(gettext(TEXT("Line")));
    dfe->addEnumText(gettext(TEXT("FAI Sector")));
    dfe->Set(StartLine);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskStartRadius"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(lround(StartRadius*DISTANCEMODIFY*DISTANCE_ROUNDING)/DISTANCE_ROUNDING);
    wp->GetDataField()->SetUnits(Units::GetDistanceName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskFAISector"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Cylinder")));
    dfe->addEnumText(gettext(TEXT("FAI Sector")));
    dfe->addEnumText(gettext(TEXT("DAe 0.5/10")));
    dfe->Set(SectorType);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskSectorRadius"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(lround(SectorRadius*DISTANCEMODIFY*DISTANCE_ROUNDING)/DISTANCE_ROUNDING);
    wp->GetDataField()->SetUnits(Units::GetDistanceName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoAdvance"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("Manual")));
    dfe->addEnumText(gettext(TEXT("Auto")));
    dfe->addEnumText(gettext(TEXT("Arm")));
    dfe->addEnumText(gettext(TEXT("Arm start")));
    dfe->Set(AutoAdvance);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpFinishMinHeight"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(FinishMinHeight*ALTITUDEMODIFY/1000)); // BUGFIX XCSOAR 100315
    wp->GetDataField()->SetUnits(Units::GetAltitudeName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpStartMaxHeight"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(StartMaxHeight*ALTITUDEMODIFY/1000)); // BUGFIX XCSOAR 100315
    wp->GetDataField()->SetUnits(Units::GetAltitudeName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpStartMaxHeightMargin"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(StartMaxHeightMargin*ALTITUDEMODIFY/1000));
    wp->GetDataField()->SetUnits(Units::GetAltitudeName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpStartHeightRef"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(gettext(TEXT("AGL")));
    dfe->addEnumText(gettext(TEXT("MSL")));
    dfe->Set(StartHeightRef);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpStartMaxSpeed"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(StartMaxSpeed*SPEEDMODIFY/1000)); 
    wp->GetDataField()->SetUnits(Units::GetHorizontalSpeedName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpStartMaxSpeedMargin"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(StartMaxSpeedMargin*SPEEDMODIFY/1000)); 
    wp->GetDataField()->SetUnits(Units::GetHorizontalSpeedName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLoggerTimeStepCruise"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(LoggerTimeStepCruise);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLoggerTimeStepCircling"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(LoggerTimeStepCircling);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpSnailWidthScale"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(MapWindow::SnailWidthScale);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpGPSAltitudeOffset"));
  if (wp) {
    wp->GetDataField()->SetAsFloat(iround(GPSAltitudeOffset*ALTITUDEMODIFY/1000)); // 100429
    wp->GetDataField()->SetUnits(Units::GetAltitudeName());
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUseGeoidSeparation"));
  if (wp) {
    wp->GetDataField()->Set(UseGeoidSeparation);
    wp->RefreshDisplay();
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpPressureHg"));
  if (wp) {
    DataFieldEnum* dfe;
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->addEnumText(TEXT("hPa"));
    dfe->addEnumText(TEXT("inHg"));
    dfe->Set(PressureHg);
    wp->RefreshDisplay();
  }

  #if 0
  wp = (WndProperty*)wf->FindByName(TEXT("prpShortcutIbox"));
  if (wp) {
    wp->GetDataField()->Set(ShortcutIbox);
    wp->RefreshDisplay();
  }
  #endif

  wp = (WndProperty*)wf->FindByName(TEXT("prpEngineeringMenu")); 
  if (wp) {
    wp->GetDataField()->Set(EngineeringMenu);
    wp->RefreshDisplay();
  }

  for (i=0; i<4; i++) {
    for (int j=0; j<9; j++) {
      SetInfoBoxSelector(j, i);
    }
  }
}




void dlgConfigurationShowModal(void){

  WndProperty *wp;

  StartHourglassCursor(); 

  if (!InfoBoxLayout::landscape) {
    char filename[MAX_PATH];
    LocalPathS(filename, TEXT("dlgConfiguration_L.xml"));
    wf = dlgLoadFromXML(CallBackTable, 
                        
                        filename, 
                        hWndMainWindow,
                        TEXT("IDR_XML_CONFIGURATION_L"));
  } else {
    char filename[MAX_PATH];
    LocalPathS(filename, TEXT("dlgConfiguration.xml"));
    wf = dlgLoadFromXML(CallBackTable,                        
                        filename, 
                        hWndMainWindow,
                        TEXT("IDR_XML_CONFIGURATION"));
  }

  if (!wf) return;
  
  wf->SetKeyDownNotify(FormKeyDown);

  ((WndButton *)wf->FindByName(TEXT("cmdClose")))->SetOnClickNotify(OnCloseClicked);

  wConfig1    = ((WndFrame *)wf->FindByName(TEXT("frmSite")));
  wConfig2    = ((WndFrame *)wf->FindByName(TEXT("frmAirspace")));
  wConfig3    = ((WndFrame *)wf->FindByName(TEXT("frmDisplay")));
  wConfig4    = ((WndFrame *)wf->FindByName(TEXT("frmTerrain")));
  wConfig5    = ((WndFrame *)wf->FindByName(TEXT("frmFinalGlide")));
  wConfig6    = ((WndFrame *)wf->FindByName(TEXT("frmSafety")));
  wConfig7    = ((WndFrame *)wf->FindByName(TEXT("frmPolar")));
  wConfig8    = ((WndFrame *)wf->FindByName(TEXT("frmComm")));
  wConfig9    = ((WndFrame *)wf->FindByName(TEXT("frmUnits")));
  wConfig10    = ((WndFrame *)wf->FindByName(TEXT("frmInterface")));
  wConfig11    = ((WndFrame *)wf->FindByName(TEXT("frmAppearance")));
  wConfig12    = ((WndFrame *)wf->FindByName(TEXT("frmFonts")));
  wConfig13    = ((WndFrame *)wf->FindByName(TEXT("frmVarioAppearance")));
  wConfig14    = ((WndFrame *)wf->FindByName(TEXT("frmTask")));
  wConfig15    = ((WndFrame *)wf->FindByName(TEXT("frmTaskRules")));
  wConfig16    = ((WndFrame *)wf->FindByName(TEXT("frmInfoBoxCircling")));
  wConfig17    = ((WndFrame *)wf->FindByName(TEXT("frmInfoBoxCruise")));
  wConfig18    = ((WndFrame *)wf->FindByName(TEXT("frmInfoBoxFinalGlide")));
  wConfig19    = ((WndFrame *)wf->FindByName(TEXT("frmInfoBoxAuxiliary")));
  wConfig20    = ((WndFrame *)wf->FindByName(TEXT("frmLogger")));
  wConfig21    = ((WndFrame *)wf->FindByName(TEXT("frmWaypointEdit")));
  wConfig22    = ((WndFrame *)wf->FindByName(TEXT("frmSpecials1")));
  wConfig23    = ((WndFrame *)wf->FindByName(TEXT("frmSpecials2")));
  wConfig24    = ((WndFrame *)wf->FindByName(TEXT("frmEngineering1")));
  wConfig25    = ((WndFrame *)wf->FindByName(TEXT("frmEngineering2")));
  //wConfig26    = ((WndFrame *)wf->FindByName(TEXT("frmEngineering3")));
  //wConfig27    = ((WndFrame *)wf->FindByName(TEXT("frmEngineering4")));
  // ADDPAGE HERE
  ASSERT(wConfig1!=NULL);
  ASSERT(wConfig2!=NULL);
  ASSERT(wConfig3!=NULL);
  ASSERT(wConfig4!=NULL);
  ASSERT(wConfig5!=NULL);
  ASSERT(wConfig6!=NULL);
  ASSERT(wConfig7!=NULL);
  ASSERT(wConfig8!=NULL);
  ASSERT(wConfig9!=NULL);
  ASSERT(wConfig10!=NULL);
  ASSERT(wConfig11!=NULL);
  ASSERT(wConfig12!=NULL);
  ASSERT(wConfig13!=NULL);
  ASSERT(wConfig14!=NULL);
  ASSERT(wConfig15!=NULL);
  ASSERT(wConfig16!=NULL);
  ASSERT(wConfig17!=NULL);
  ASSERT(wConfig18!=NULL);
  ASSERT(wConfig19!=NULL);
  ASSERT(wConfig20!=NULL);
  ASSERT(wConfig21!=NULL);
  ASSERT(wConfig22!=NULL);
  ASSERT(wConfig23!=NULL);
  ASSERT(wConfig24!=NULL);
  ASSERT(wConfig25!=NULL);
  //ASSERT(wConfig26!=NULL);
  //ASSERT(wConfig27!=NULL);
  // ADDPAGE HERE

  wf->FilterAdvanced(UserLevel>0);


#if !defined(PNA) && !defined(FIVV)
  // JMW we don't want these for non-PDA platforms yet
  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInfoBoxGeom"));
  if (wp) {
    wp->SetVisible(false);
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInfoBoxModel"));
  if (wp) {
    wp->SetVisible(false);
  }
#endif

  for (int item=0; item<10; item++) {
    cpyInfoBox[item] = -1;
  }

  setVariables();

  UpdateDeviceSetupButton(0, devA()->Name);
  UpdateDeviceSetupButton(1, devB()->Name);

  NextPage(0); // just to turn proper pages on/off

  changed = false;
  taskchanged = false;
  requirerestart = false;
  utcchanged = false;
  waypointneedsave = false;

  StopHourglassCursor();
  wf->ShowModal();

  // TODO enhancement: implement a cancel button that skips all this
  // below after exit.

  wp = (WndProperty*)wf->FindByName(TEXT("prpAbortSafetyUseCurrent"));
  if (wp) {
    if (GlidePolar::AbortSafetyUseCurrent
	!= wp->GetDataField()->GetAsBoolean()) {
      GlidePolar::AbortSafetyUseCurrent = 
	wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryAbortSafetyUseCurrent, 
		    GlidePolar::AbortSafetyUseCurrent);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpDisableAutoLogger"));
  if (wp) {
    if (!DisableAutoLogger
	!= wp->GetDataField()->GetAsBoolean()) {
      DisableAutoLogger = 
	!(wp->GetDataField()->GetAsBoolean());
      SetToRegistry(szRegistryDisableAutoLogger, 
		    DisableAutoLogger);
      changed = true;
    }
  }

  double val;

  wp = (WndProperty*)wf->FindByName(TEXT("prpSafetyMacCready"));
  if (wp) {
    val = wp->GetDataField()->GetAsFloat()/LIFTMODIFY;
    if (GlidePolar::SafetyMacCready != val) {
      GlidePolar::SafetyMacCready = val;
      SetToRegistry(szRegistrySafetyMacCready, 
		    iround(GlidePolar::SafetyMacCready*10));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpRiskGamma"));
  if (wp) {
    val = wp->GetDataField()->GetAsFloat();
    if (GlidePolar::RiskGamma != val) {
      GlidePolar::RiskGamma = val;
      SetToRegistry(szRegistryRiskGamma, 
		    iround(GlidePolar::RiskGamma*10));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpSetSystemTimeFromGPS"));
  if (wp) {
    if (SetSystemTimeFromGPS != wp->GetDataField()->GetAsBoolean()) {
      SetSystemTimeFromGPS = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistrySetSystemTimeFromGPS, SetSystemTimeFromGPS);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAnimation"));
  if (wp) {
    if (EnableAnimation != wp->GetDataField()->GetAsBoolean()) {
      EnableAnimation = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryAnimation, EnableAnimation);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTrailDrift"));
  if (wp) {
    if (MapWindow::EnableTrailDrift != wp->GetDataField()->GetAsBoolean()) {
      MapWindow::EnableTrailDrift = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryTrailDrift, MapWindow::EnableTrailDrift);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpThermalLocator"));
  if (wp) {
    if (EnableThermalLocator != wp->GetDataField()->GetAsInteger()) {
      EnableThermalLocator = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryThermalLocator, EnableThermalLocator);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTrail"));
  if (wp) {
    if (TrailActive != wp->GetDataField()->GetAsInteger()) {
      TrailActive = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistrySnailTrail, TrailActive);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLKMaxLabels"));
  if (wp) {
    if (LKMaxLabels != wp->GetDataField()->GetAsInteger()) {
      LKMaxLabels = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryLKMaxLabels, LKMaxLabels);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpPGCruiseZoom"));
  if (wp) {
    if ( PGCruiseZoom != wp->GetDataField()->GetAsInteger()) {
      PGCruiseZoom = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryPGCruiseZoom, PGCruiseZoom);
      changed = true;
	InitAircraftCategory(); // 100512
        requirerestart=true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpPGClimbZoom"));
  if (wp) {
    if ( PGClimbZoom != wp->GetDataField()->GetAsInteger()) {
      PGClimbZoom = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryPGClimbZoom, PGClimbZoom);
      changed = true;
	SetMapScales(); // 100512
        requirerestart=true; 
    }
  }

  #if AUTORIENT
  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoOrientScale"));
  if (wp) {
    if ( AutoOrientScale != wp->GetDataField()->GetAsInteger()) {
      AutoOrientScale = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryAutoOrientScale, AutoOrientScale);
      changed = true;
    }
  }
  #endif

  wp = (WndProperty*)wf->FindByName(TEXT("prpPGNumberOfGates"));
  if (wp) {
    if ( PGNumberOfGates != wp->GetDataField()->GetAsInteger()) {
      PGNumberOfGates = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryPGNumberOfGates, PGNumberOfGates);
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpPGOpenTimeH"));
  if (wp) {
    if ( PGOpenTimeH != wp->GetDataField()->GetAsInteger()) {
      PGOpenTimeH = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryPGOpenTimeH, PGOpenTimeH);
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpPGOpenTimeM"));
  if (wp) {
    if ( PGOpenTimeM != wp->GetDataField()->GetAsInteger()) {
      PGOpenTimeM = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryPGOpenTimeM, PGOpenTimeM);
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpPGGateIntervalTime"));
  if (wp) {
    if ( PGGateIntervalTime != wp->GetDataField()->GetAsInteger()) {
      PGGateIntervalTime = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryPGGateIntervalTime, PGGateIntervalTime);
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpPGStartOut"));
  if (wp) {
    if ( PGStartOut != wp->GetDataField()->GetAsInteger()) {
      PGStartOut = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryPGStartOut, PGStartOut);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpPolarType"));
  if (wp) {
    if (POLARID != wp->GetDataField()->GetAsInteger()) {
      POLARID = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryPolarID, POLARID);
      GlidePolar::SetBallast();
      POLARFILECHANGED = true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAirspaceDisplay"));
  if (wp) {
    if (AltitudeMode != wp->GetDataField()->GetAsInteger()) {
      AltitudeMode = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryAltMode, AltitudeMode);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpSafetyAltitudeMode"));
  if (wp) {
    if (SafetyAltitudeMode != wp->GetDataField()->GetAsInteger()) {
      SafetyAltitudeMode = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistrySafetyAltitudeMode, SafetyAltitudeMode);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLockSettingsInFlight"));
  if (wp) {
    if (LockSettingsInFlight != 
	wp->GetDataField()->GetAsBoolean()) {
      LockSettingsInFlight = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryLockSettingsInFlight,
		    LockSettingsInFlight);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLoggerShortName"));
  if (wp) {
    if (LoggerShortName != 
	wp->GetDataField()->GetAsBoolean()) {
      LoggerShortName = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryLoggerShort,
		    LoggerShortName);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableFLARMMap"));
  if (wp) {
    if ((int)EnableFLARMMap != 
	wp->GetDataField()->GetAsInteger()) {
      EnableFLARMMap = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryEnableFLARMMap,
		    EnableFLARMMap);
      changed = true;
    }
  }

  #if 0
  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableFLARMGauge"));
  if (wp) {
    if (EnableFLARMGauge != 
	wp->GetDataField()->GetAsBoolean()) {
      EnableFLARMGauge = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryEnableFLARMGauge,
		    EnableFLARMGauge);
      changed = true;
    }
  }
  #endif

  wp = (WndProperty*)wf->FindByName(TEXT("prpDebounceTimeout"));
  if (wp) {
    if (debounceTimeout != wp->GetDataField()->GetAsInteger()) {
      debounceTimeout = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryDebounceTimeout, debounceTimeout);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAirspaceOutline"));
  if (wp) {
    if (MapWindow::bAirspaceBlackOutline != 
	wp->GetDataField()->GetAsBoolean()) {
      MapWindow::bAirspaceBlackOutline = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryAirspaceBlackOutline,
		    MapWindow::bAirspaceBlackOutline);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoZoom"));
  if (wp) {
    if (MapWindow::AutoZoom != 
	wp->GetDataField()->GetAsBoolean()) {
      MapWindow::AutoZoom = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryAutoZoom,
		    MapWindow::AutoZoom);
      changed = true;
    }
  }

  int ival;

  wp = (WndProperty*)wf->FindByName(TEXT("prpUTCOffset"));
  if (wp) {
    ival = iround(wp->GetDataField()->GetAsFloat()*3600.0);
    if ((UTCOffset != ival)||(utcchanged)) {
      UTCOffset = ival;

      // have to do this because registry variables can't be negative!
      int lival = UTCOffset;
      if (lival<0) { lival+= 24*3600; }
      SetToRegistry(szRegistryUTCOffset, lival);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpClipAltitude"));
  if (wp) {
    ival = iround(wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY);
    if (ClipAltitude != ival) {
      ClipAltitude = ival;
      SetToRegistry(szRegistryClipAlt,ClipAltitude);  // fixed 20060430/sgi was szRegistryAltMode
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAltWarningMargin"));
  if (wp) {
    ival = iround(wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY);
    if (AltWarningMargin != ival) {
      AltWarningMargin = ival;
      SetToRegistry(szRegistryAltMargin,AltWarningMargin);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAirspaceWarnings"));
  if (wp) {
    if (AIRSPACEWARNINGS != wp->GetDataField()->GetAsInteger()) {
      AIRSPACEWARNINGS = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryAirspaceWarning,(DWORD)AIRSPACEWARNINGS);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWarningTime"));
  if (wp) {
    if (WarningTime != wp->GetDataField()->GetAsInteger()) {
      WarningTime = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryWarningTime,(DWORD)WarningTime);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAcknowledgementTime"));
  if (wp) {
    if (AcknowledgementTime != wp->GetDataField()->GetAsInteger()) {
      AcknowledgementTime = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryAcknowledgementTime,
		    (DWORD)AcknowledgementTime);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWaypointLabels"));
  if (wp) {
    if (DisplayTextType != wp->GetDataField()->GetAsInteger()) {
      DisplayTextType = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryDisplayText,DisplayTextType);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableTerrain"));
  if (wp) {
    if (EnableTerrain != wp->GetDataField()->GetAsBoolean()) {
      EnableTerrain = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryDrawTerrain, EnableTerrain);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableTopology"));
  if (wp) {
    if (EnableTopology != wp->GetDataField()->GetAsBoolean()) {
      EnableTopology = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryDrawTopology, EnableTopology);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpCirclingZoom"));
  if (wp) {
    if (CircleZoom != wp->GetDataField()->GetAsBoolean()) {
      CircleZoom = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryCircleZoom, CircleZoom);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpOrientation"));
  if (wp) {
#if AUTORIENT
    if (OldDisplayOrientation != wp->GetDataField()->GetAsInteger()) {
      OldDisplayOrientation = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryDisplayUpValue,OldDisplayOrientation);
      DisplayOrientation=OldDisplayOrientation;
      changed = true;
    }
#else
    if (DisplayOrientation != wp->GetDataField()->GetAsInteger()) {
      DisplayOrientation = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryDisplayUpValue,DisplayOrientation);
      changed = true;
    }
#endif
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpMenuTimeout"));
  if (wp) {
    if (MenuTimeoutMax != wp->GetDataField()->GetAsInteger()*2) {
      MenuTimeoutMax = wp->GetDataField()->GetAsInteger()*2;
      SetToRegistry(szRegistryMenuTimeout,MenuTimeoutMax);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpSafetyAltitudeArrival"));
  if (wp) {
    ival = iround(wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY);
    if (SAFETYALTITUDEARRIVAL != ival) {
      SAFETYALTITUDEARRIVAL = ival;
      SetToRegistry(szRegistrySafetyAltitudeArrival,
		    (DWORD)SAFETYALTITUDEARRIVAL);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpSafetyAltitudeBreakoff"));
  if (wp) {
    ival = iround(wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY);
    if (SAFETYALTITUDEBREAKOFF != ival) {
      SAFETYALTITUDEBREAKOFF = ival;
      SetToRegistry(szRegistrySafetyAltitudeBreakOff,
		    (DWORD)SAFETYALTITUDEBREAKOFF);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpSafetyAltitudeTerrain"));
  if (wp) {
    ival = iround(wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY);
    if (SAFETYALTITUDETERRAIN != ival) {
      SAFETYALTITUDETERRAIN = ival;
      SetToRegistry(szRegistrySafetyAltitudeTerrain,
		    (DWORD)SAFETYALTITUDETERRAIN);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoWind"));
  if (wp) {
    if (AutoWindMode != wp->GetDataField()->GetAsInteger()) {
      AutoWindMode = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryAutoWind, AutoWindMode);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWindArrowStyle"));
  if (wp) {
    if (MapWindow::WindArrowStyle != wp->GetDataField()->GetAsInteger()) {
      MapWindow::WindArrowStyle = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryWindArrowStyle, MapWindow::WindArrowStyle);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoMcMode"));
  if (wp) {
    if (AutoMcMode != wp->GetDataField()->GetAsInteger()) {
      AutoMcMode = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryAutoMcMode, AutoMcMode);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWaypointsOutOfRange"));
  if (wp) {
    if (WaypointsOutOfRange != wp->GetDataField()->GetAsInteger()) {
      WaypointsOutOfRange = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryWaypointsOutOfRange, WaypointsOutOfRange);
      WAYPOINTFILECHANGED= true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoForceFinalGlide"));
  if (wp) {
    if (AutoForceFinalGlide != wp->GetDataField()->GetAsBoolean()) {
      AutoForceFinalGlide = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryAutoForceFinalGlide, AutoForceFinalGlide);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableNavBaroAltitude"));
  if (wp) {
    if (EnableNavBaroAltitude != wp->GetDataField()->GetAsBoolean()) {
      EnableNavBaroAltitude = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryEnableNavBaroAltitude, EnableNavBaroAltitude);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpOrbiter"));
  if (wp) {
    if (Orbiter != wp->GetDataField()->GetAsBoolean()) {
      Orbiter = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryOrbiter, Orbiter);
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpShading"));
  if (wp) {
    if (Shading != wp->GetDataField()->GetAsBoolean()) {
      Shading = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryShading, Shading);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpFinalGlideTerrain"));
  if (wp) {
    if (FinalGlideTerrain != wp->GetDataField()->GetAsInteger()) {
      FinalGlideTerrain = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryFinalGlideTerrain, FinalGlideTerrain);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpBlockSTF"));
  if (wp) {
    if (EnableBlockSTF != wp->GetDataField()->GetAsBoolean()) {
      EnableBlockSTF = wp->GetDataField()->GetAsBoolean();
      SetToRegistry(szRegistryBlockSTF, EnableBlockSTF);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsSpeed"));
  if (wp) {
    if ((int)Speed != wp->GetDataField()->GetAsInteger()) {
      Speed = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistrySpeedUnitsValue, Speed);
      Units::NotifyUnitChanged();
      requirerestart = true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsLatLon"));
  if (wp) {
    if ((int)Units::CoordinateFormat != wp->GetDataField()->GetAsInteger()) {
      Units::CoordinateFormat = (CoordinateFormats_t)
        wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryLatLonUnits, Units::CoordinateFormat);
      Units::NotifyUnitChanged();
      requirerestart = true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsTaskSpeed"));
  if (wp) {
    if ((int)TaskSpeed != wp->GetDataField()->GetAsInteger()) {
      TaskSpeed = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryTaskSpeedUnitsValue, TaskSpeed);
      Units::NotifyUnitChanged();
      requirerestart = true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsDistance"));
  if (wp) {
    if ((int)Distance != wp->GetDataField()->GetAsInteger()) {
      Distance = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryDistanceUnitsValue, Distance);
      Units::NotifyUnitChanged();
      requirerestart = true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsLift"));
  if (wp) {
    if ((int)Lift != wp->GetDataField()->GetAsInteger()) {
      Lift = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryLiftUnitsValue, Lift);
      Units::NotifyUnitChanged();
      requirerestart = true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUnitsAltitude"));
  if (wp) {
    if ((int)Altitude != wp->GetDataField()->GetAsInteger()) {
      Altitude = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryAltitudeUnitsValue, Altitude);
      Units::NotifyUnitChanged();
      changed = true;
      requirerestart = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpFAIFinishHeight"));
  if (wp) {
    if (EnableFAIFinishHeight != (wp->GetDataField()->GetAsInteger()>0)) {
      EnableFAIFinishHeight = (wp->GetDataField()->GetAsInteger()>0);
      SetToRegistry(szRegistryFAIFinishHeight, EnableFAIFinishHeight);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpOLCRules"));
  if (wp) {
    if (OLCRules != wp->GetDataField()->GetAsInteger()) {
      OLCRules = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryOLCRules, OLCRules);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpHandicap"));
  if (wp) {
    ival  = wp->GetDataField()->GetAsInteger();
    if (Handicap != ival) {
      Handicap = ival;
      SetToRegistry(szRegistryHandicap, Handicap);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpPolarFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szPolarFile)) {
      SetRegistryString(szRegistryPolarFile, temptext);
      POLARFILECHANGED = true;
      GlidePolar::SetBallast();
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWaypointFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szWaypointFile)) {
      SetRegistryString(szRegistryWayPointFile, temptext);
      WAYPOINTFILECHANGED= true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAdditionalWaypointFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szAdditionalWaypointFile)) {
      SetRegistryString(szRegistryAdditionalWayPointFile, temptext);
      WAYPOINTFILECHANGED= true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAirspaceFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szAirspaceFile)) {
      SetRegistryString(szRegistryAirspaceFile, temptext);
      AIRSPACEFILECHANGED= true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAdditionalAirspaceFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szAdditionalAirspaceFile)) {
      SetRegistryString(szRegistryAdditionalAirspaceFile, temptext);
      AIRSPACEFILECHANGED= true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpMapFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szMapFile)) {
      SetRegistryString(szRegistryMapFile, temptext);
      MAPFILECHANGED= true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTerrainFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szTerrainFile)) {
      SetRegistryString(szRegistryTerrainFile, temptext);
      TERRAINFILECHANGED= true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTopologyFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szTopologyFile)) {
      SetRegistryString(szRegistryTopologyFile, temptext);
      TOPOLOGYFILECHANGED= true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAirfieldFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szAirfieldFile)) {
      SetRegistryString(szRegistryAirfieldFile, temptext);
      AIRFIELDFILECHANGED= true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLanguageFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szLanguageFile)) {
      SetRegistryString(szRegistryLanguageFile, temptext);
      requirerestart = true; // restart needed for XCI reload
      LKReadLanguageFile();
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpStatusFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szStatusFile)) {
      SetRegistryString(szRegistryStatusFile, temptext);
      requirerestart = true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpInputFile"));
  if (wp) {
    DataFieldFileReader* dfe;
    dfe = (DataFieldFileReader*)wp->GetDataField();
    _tcscpy(temptext, dfe->GetPathFile());
    ContractLocalPath(temptext);
    if (_tcscmp(temptext,szInputFile)) {
      SetRegistryString(szRegistryInputFile, temptext);
      requirerestart = true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpBallastSecsToEmpty"));
  if (wp) {
    ival = wp->GetDataField()->GetAsInteger();
    if (BallastSecsToEmpty != ival) {
      BallastSecsToEmpty = ival;
      SetToRegistry(szRegistryBallastSecsToEmpty,(DWORD)BallastSecsToEmpty);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWindCalcTime")); // 100113
  if (wp) {
	ival = wp->GetDataField()->GetAsInteger();
	if (WindCalcTime != ival) {
		WindCalcTime = ival;
		SetToRegistry(szRegistryWindCalcTime,(DWORD)WindCalcTime);
		changed = true;
	}
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpMaxManoeuveringSpeed"));
  if (wp) {
    ival = iround((wp->GetDataField()->GetAsInteger()/SPEEDMODIFY)*1000.0);
    if ((int)SAFTEYSPEED != (int)iround(ival/1000)) {
      SAFTEYSPEED = ival;
      SetToRegistry(szRegistrySafteySpeed,(DWORD)SAFTEYSPEED);
	SAFTEYSPEED=ival/1000.0;
      GlidePolar::SetBallast();
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpWindCalcSpeed")); // 100112
  if (wp) {
	ival = iround((wp->GetDataField()->GetAsInteger()/SPEEDMODIFY)*1000.0);
	if ((int)WindCalcSpeed != (int)iround(ival/1000)) {
		WindCalcSpeed = ival;
		SetToRegistry(szRegistryWindCalcSpeed,(DWORD)WindCalcSpeed);
		WindCalcSpeed=ival/1000.0;
		changed = true;
	}
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskFinishLine"));
  if (wp) {
    if (FinishLine != wp->GetDataField()->GetAsInteger()) {
      FinishLine = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryFinishLine,FinishLine);
      changed = true;
      taskchanged = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskFinishRadius"));
  if (wp) {
    ival = iround(wp->GetDataField()->GetAsFloat()/DISTANCEMODIFY);
    if ((int)FinishRadius != ival) {
      FinishRadius = ival;
      SetToRegistry(szRegistryFinishRadius,FinishRadius);
      changed = true;
      taskchanged = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskStartLine"));
  if (wp) {
    if (StartLine != wp->GetDataField()->GetAsInteger()) {
      StartLine = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryStartLine,StartLine);
      changed = true;
      taskchanged = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskStartRadius"));
  if (wp) {
    ival = iround(wp->GetDataField()->GetAsFloat()/DISTANCEMODIFY);
    if ((int)StartRadius != ival) {
      StartRadius = ival;
      SetToRegistry(szRegistryStartRadius,StartRadius);
      changed = true;
      taskchanged = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskFAISector"));
  if (wp) {
    if ((int)SectorType != wp->GetDataField()->GetAsInteger()) {
      SectorType = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryFAISector,SectorType);
      changed = true;
      taskchanged = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTaskSectorRadius"));
  if (wp) {
    ival = iround(wp->GetDataField()->GetAsFloat()/DISTANCEMODIFY);
    if ((int)SectorRadius != ival) {
      SectorRadius = ival;
      SetToRegistry(szRegistrySectorRadius,SectorRadius);
      changed = true;
      taskchanged = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppIndFinalGlide"));
  if (wp) {
    if (Appearance.IndFinalGlide != (IndFinalGlide_t)(wp->GetDataField()->GetAsInteger())) {
      Appearance.IndFinalGlide = (IndFinalGlide_t)(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryAppIndFinalGlide,(DWORD)(Appearance.IndFinalGlide));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppCompassAppearance"));
  if (wp) {
    if (Appearance.CompassAppearance != (CompassAppearance_t)
	(wp->GetDataField()->GetAsInteger())) {
      Appearance.CompassAppearance = (CompassAppearance_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryAppCompassAppearance,
		    (DWORD)(Appearance.CompassAppearance));
      changed = true;
      requirerestart = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInfoBoxBorder"));
  if (wp) {
    if (Appearance.InfoBoxBorder != (InfoBoxBorderAppearance_t)
	(wp->GetDataField()->GetAsInteger())) {
      Appearance.InfoBoxBorder = (InfoBoxBorderAppearance_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryAppInfoBoxBorder,
		    (DWORD)(Appearance.InfoBoxBorder));
      changed = true;
      requirerestart = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAircraftCategory")); // VENTA4
  if (wp) {
    if (AircraftCategory != (AircraftCategory_t)
	(wp->GetDataField()->GetAsInteger())) {
      AircraftCategory = (AircraftCategory_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryAircraftCategory,
		    (DWORD)(AircraftCategory));
      changed = true;
      requirerestart = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpExtendedVisualGlide")); // VENTA4
  if (wp) {
    if (ExtendedVisualGlide != (ExtendedVisualGlide_t)
	(wp->GetDataField()->GetAsInteger())) {
      ExtendedVisualGlide = (ExtendedVisualGlide_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryExtendedVisualGlide,
		    (DWORD)(ExtendedVisualGlide));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLook8000"));
  if (wp) {
    if (Look8000 != (Look8000_t)
	(wp->GetDataField()->GetAsInteger())) {
      Look8000 = (Look8000_t)
	(wp->GetDataField()->GetAsInteger());
	if (Look8000!=0) { // 091115 do not allow Reserved mode , do not disable LK8000 !
		SetToRegistry(szRegistryLook8000, (DWORD)(Look8000));
		changed = true;
	} else Look8000=1;
    }
  }

#if (0)
  wp = (WndProperty*)wf->FindByName(TEXT("prpAltArrivMode"));
  if (wp) {
    if (AltArrivMode != (AltArrivMode_t)
	(wp->GetDataField()->GetAsInteger())) {
      AltArrivMode = (AltArrivMode_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryAltArrivMode,
		    (DWORD)(AltArrivMode));
      changed = true;
    }
  }
#endif

  wp = (WndProperty*)wf->FindByName(TEXT("prpNewMap")); 
  if (wp) {
    if (NewMap != (NewMap_t)
	(wp->GetDataField()->GetAsInteger())) {
      NewMap = (NewMap_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryNewMap,
		    (DWORD)(NewMap));
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpCheckSum")); 
  if (wp) {
    if (CheckSum != (CheckSum_t)
	(wp->GetDataField()->GetAsInteger())) {
      CheckSum = (CheckSum_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryCheckSum,
		    (DWORD)(CheckSum));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpIphoneGestures")); 
  if (wp) {
    if (IphoneGestures != (IphoneGestures_t) (wp->GetDataField()->GetAsInteger())) {
      IphoneGestures = (IphoneGestures_t) (wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryIphoneGestures, (DWORD)(IphoneGestures));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpPollingMode")); 
  if (wp) {
    if (PollingMode != (PollingMode_t) (wp->GetDataField()->GetAsInteger())) {
      PollingMode = (PollingMode_t) (wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryPollingMode, (DWORD)(PollingMode));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLKVarioBar")); 
  if (wp) {
    if (LKVarioBar != (LKVarioBar_t)
	(wp->GetDataField()->GetAsInteger())) {
      LKVarioBar = (LKVarioBar_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryLKVarioBar,
		    (DWORD)(LKVarioBar));
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpHideUnits")); // VENTA6
  if (wp) {
    if (HideUnits != (HideUnits_t)
	(wp->GetDataField()->GetAsInteger())) {
      HideUnits = (HideUnits_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryHideUnits,
		    (DWORD)(HideUnits));
      changed = true;
      requirerestart = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpDeclutterMode")); // VENTA10
  if (wp) {
    if (DeclutterMode != (DeclutterMode_t)
	(wp->GetDataField()->GetAsInteger())) {
      DeclutterMode = (DeclutterMode_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryDeclutterMode,
		    (DWORD)(DeclutterMode));
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpVirtualKeys")); // VENTA6
  if (wp) {
    if (VirtualKeys != (VirtualKeys_t)
	(wp->GetDataField()->GetAsInteger())) {
      VirtualKeys = (VirtualKeys_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryVirtualKeys,
		    (DWORD)(VirtualKeys));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUseMapLock")); // VENTA9
  if (wp) {
    if (UseMapLock != (UseMapLock_t) (wp->GetDataField()->GetAsInteger())) {
      UseMapLock = (UseMapLock_t) (wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryUseMapLock, (DWORD)(UseMapLock));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpActiveMap")); // 100318
  if (wp) {
    if (ActiveMap != (ActiveMap_t) (wp->GetDataField()->GetAsInteger())) {
      ActiveMap = (ActiveMap_t) (wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryActiveMap, (DWORD)(ActiveMap));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpBestWarning"));
  if (wp) {
    if (BestWarning != (wp->GetDataField()->GetAsInteger())) {
      BestWarning = (wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryBestWarning, (DWORD)(BestWarning));
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpThermalBar"));
  if (wp) {
    if (ThermalBar != (wp->GetDataField()->GetAsInteger())) {
      ThermalBar = (wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryThermalBar, (DWORD)(ThermalBar));
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpOverlayClock"));
  if (wp) {
    if (OverlayClock != (wp->GetDataField()->GetAsInteger())) {
      OverlayClock = (wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryOverlayClock, (DWORD)(OverlayClock));
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpMcOverlay"));
  if (wp) {
    if (McOverlay != (wp->GetDataField()->GetAsInteger())) {
      McOverlay = (wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryMcOverlay, (DWORD)(McOverlay));
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpTrackBar"));
  if (wp) {
    if (TrackBar != (wp->GetDataField()->GetAsInteger())) {
      TrackBar = (wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryTrackBar, (DWORD)(TrackBar));
      changed = true;
    }
  }


  wp = (WndProperty*)wf->FindByName(TEXT("prpOutlinedTp")); // VENTA6
  if (wp) {
    if (OutlinedTp != (OutlinedTp_t)
	(wp->GetDataField()->GetAsInteger())) {
      OutlinedTp = (OutlinedTp_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryOutlinedTp,
		    (DWORD)(OutlinedTp));
      changed = true;
      requirerestart = true; // 100819
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTpFilter"));
  if (wp) {
    if (TpFilter != (TpFilter_t)
	(wp->GetDataField()->GetAsInteger())) {
      TpFilter = (TpFilter_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryTpFilter,
		    (DWORD)(TpFilter));
      LastRangeLandableTime=0;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpOverColor"));
  if (wp) {
    if (OverColor != (OverColor_t)
	(wp->GetDataField()->GetAsInteger())) {
      OverColor = (OverColor_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryOverColor,
		    (DWORD)(OverColor));
      SetOverColorRef();
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpMapBox")); // VENTA6
  if (wp) {
    if (MapBox != (MapBox_t)
	(wp->GetDataField()->GetAsInteger())) {
      MapBox = (MapBox_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryMapBox,
		    (DWORD)(MapBox));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpGlideBarMode")); // VENTA6
  if (wp) {
    if (GlideBarMode != (GlideBarMode_t)
	(wp->GetDataField()->GetAsInteger())) {
      GlideBarMode = (GlideBarMode_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryGlideBarMode,
		    (DWORD)(GlideBarMode));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpNewMapDeclutter")); // VENTA6
  if (wp) {
    if (NewMapDeclutter != 
	(wp->GetDataField()->GetAsInteger())) {
      NewMapDeclutter = 
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryNewMapDeclutter,
		    (DWORD)(NewMapDeclutter));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpGPSAltitudeOffset")); 
  if (wp) {
    ival = iround( (wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY)*1000.0);  
    if ( ((int)GPSAltitudeOffset) != ival ) {
	GPSAltitudeOffset = ival;
	SetToRegistry(szRegistryGpsAltitudeOffset, (DWORD)(GPSAltitudeOffset));
	changed=true;
    }

/* BUGFIX 100429 REMOVE
    if (GPSAltitudeOffset != (wp->GetDataField()->GetAsInteger())) {
      GPSAltitudeOffset = (wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryGpsAltitudeOffset, (DWORD)(GPSAltitudeOffset));
      changed = true;
    }
*/
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpUseGeoidSeparation"));
  if (wp) {
	if (UseGeoidSeparation != (wp->GetDataField()->GetAsInteger())) {
		UseGeoidSeparation = (wp->GetDataField()->GetAsInteger());
		SetToRegistry(szRegistryUseGeoidSeparation, (DWORD)(UseGeoidSeparation));
		changed=true;
	}
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpPressureHg"));
  if (wp) {
	if (PressureHg != (wp->GetDataField()->GetAsInteger())) {
		PressureHg = (wp->GetDataField()->GetAsInteger());
		SetToRegistry(szRegistryPressureHg, (DWORD)(PressureHg));
		changed=true;
	}
  }

  #if 0
  wp = (WndProperty*)wf->FindByName(TEXT("prpShortcutIbox"));
  if (wp) {
	if (ShortcutIbox != (wp->GetDataField()->GetAsInteger())) {
		ShortcutIbox = (wp->GetDataField()->GetAsInteger());
		SetToRegistry(szRegistryShortcutIbox, (DWORD)(ShortcutIbox));
		changed=true;
	}
  }
  #endif

  wp = (WndProperty*)wf->FindByName(TEXT("prpAverEffTime")); // VENTA6
  if (wp) {
    if (AverEffTime != 
	(wp->GetDataField()->GetAsInteger())) {
      AverEffTime = 
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryAverEffTime,
		    (DWORD)(AverEffTime));
      changed = true;
      InitLDRotary(&rotaryLD);
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpBgMapcolor"));
  if (wp) {
    if (BgMapColor != 
	(wp->GetDataField()->GetAsInteger())) {
      BgMapColor = 
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryBgMapColor, (DWORD)(BgMapColor));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpArrivalValue")); // VENTA6
  if (wp) {
    if (ArrivalValue != (ArrivalValue_t)
	(wp->GetDataField()->GetAsInteger())) {
      ArrivalValue = (ArrivalValue_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryArrivalValue,
		    (DWORD)(ArrivalValue));
      changed = true;
    }
  }

#if defined(PNA) || defined(FIVV)
// VENTA-ADDON GEOM
  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInfoBoxGeom"));
  if (wp) {
    if (Appearance.InfoBoxGeom != (InfoBoxGeomAppearance_t)
        (wp->GetDataField()->GetAsInteger())) {
      Appearance.InfoBoxGeom = (InfoBoxGeomAppearance_t)
        (wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryAppInfoBoxGeom,
                    (DWORD)(Appearance.InfoBoxGeom));
      changed = true;
      requirerestart = true;
    }
  }
//
#endif

#if defined(PNA) 
// VENTA-ADDON MODEL CHANGE
  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInfoBoxModel"));
  if (wp) {
    if (Appearance.InfoBoxModel != (InfoBoxModelAppearance_t)
        (wp->GetDataField()->GetAsInteger())) {
      Appearance.InfoBoxModel = (InfoBoxModelAppearance_t)
        (wp->GetDataField()->GetAsInteger());

      switch (Appearance.InfoBoxModel) {
      case apImPnaGeneric: 
	GlobalModelType = MODELTYPE_PNA_PNA;
	break;
      case apImPnaHp31x:
	GlobalModelType = MODELTYPE_PNA_HP31X;
	break;
      case apImPnaPn6000:
	GlobalModelType = MODELTYPE_PNA_PN6000;
	break;
      case apImPnaMio:
	GlobalModelType = MODELTYPE_PNA_MIO;
	break;
      case apImPnaNokia500:
	GlobalModelType = MODELTYPE_PNA_NOKIA_500;
	break;
      case apImPnaMedionP5:
	GlobalModelType = MODELTYPE_PNA_MEDION_P5;
	break;
      case apImPnaNavigon:
	GlobalModelType = MODELTYPE_PNA_NAVIGON;
	break;
      default:
	GlobalModelType = MODELTYPE_UNKNOWN; // Can't happen, troubles ..
	break;
	
      }
      SetToRegistry(szRegistryAppInfoBoxModel,
                    GlobalModelType);
      changed = true;
      requirerestart = true;
    }
  }
//
#endif

  //Fonts
  int UseCustomFontsold = UseCustomFonts;
  wp = (WndProperty*)wf->FindByName(TEXT("prpUseCustomFonts"));
  if (wp) {
    DataFieldBoolean * dfb = (DataFieldBoolean*) wp->GetDataField();
    if (dfb) {
      SetToRegistry(szRegistryUseCustomFonts, dfb->GetAsInteger());  
      UseCustomFonts = dfb->GetAsInteger(); // global var
    }
  }
  if ( (UseCustomFontsold != UseCustomFonts) ||
    (UseCustomFonts && FontRegistryChanged) ) {
      changed = true;
      requirerestart = true;
  }
  DeleteObject(TempUseCustomFontsFont);

  DeleteObject (TempInfoWindowFont);
  DeleteObject (TempTitleWindowFont);
  DeleteObject (TempMapWindowFont);
  DeleteObject (TempTitleSmallWindowFont);
  DeleteObject (TempMapWindowBoldFont);
  DeleteObject (TempCDIWindowFont); 
  DeleteObject (TempMapLabelFont);
  DeleteObject (TempStatisticsFont);


  wp = (WndProperty*)wf->FindByName(TEXT("prpAppStatusMessageAlignment"));
  if (wp) {
    if (Appearance.StateMessageAlligne != (StateMessageAlligne_t)
	(wp->GetDataField()->GetAsInteger())) {
      Appearance.StateMessageAlligne = (StateMessageAlligne_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryAppStatusMessageAlignment,
		    (DWORD)(Appearance.StateMessageAlligne));
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTextInput"));
  if (wp) 
  {
    if (Appearance.TextInputStyle != (TextInputStyle_t)(wp->GetDataField()->GetAsInteger())) 
      {
	Appearance.TextInputStyle = (TextInputStyle_t)(wp->GetDataField()->GetAsInteger());
	SetToRegistry(szRegistryAppTextInputStyle, (DWORD)(Appearance.TextInputStyle));
	changed = true;
      }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppIndLandable"));
  if (wp) {
    if (Appearance.IndLandable != (IndLandable_t)(wp->GetDataField()->GetAsInteger())) {
      Appearance.IndLandable = (IndLandable_t)(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryAppIndLandable,(DWORD)(Appearance.IndLandable));
      changed = true;
      requirerestart = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpEnableExternalTriggerCruise"));
  if (wp) {
    if ((int)(EnableExternalTriggerCruise) != 
	wp->GetDataField()->GetAsInteger()) {
      EnableExternalTriggerCruise = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryEnableExternalTriggerCruise,
		    EnableExternalTriggerCruise);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInverseInfoBox"));
  if (wp) {
    if ((int)(Appearance.InverseInfoBox) != wp->GetDataField()->GetAsInteger()) {
      Appearance.InverseInfoBox = (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAppInverseInfoBox,Appearance.InverseInfoBox);
      requirerestart = true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpGliderScreenPosition"));
  if (wp) {
    if (MapWindow::GliderScreenPosition != 
	wp->GetDataField()->GetAsInteger()) {
      MapWindow::GliderScreenPosition = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryGliderScreenPosition,
		    MapWindow::GliderScreenPosition);
#ifdef NEWMOVEICON
	MapWindow::GliderScreenPositionY=MapWindow::GliderScreenPosition;
#endif
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppDefaultMapWidth"));
  if (wp) {
    if ((int)(Appearance.DefaultMapWidth) != 
	wp->GetDataField()->GetAsInteger()) {
      Appearance.DefaultMapWidth = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryAppDefaultMapWidth,Appearance.DefaultMapWidth);
      requirerestart = true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppAveNeedle"));
  if (wp) {
    if ((int)(Appearance.GaugeVarioAveNeedle) != 
	wp->GetDataField()->GetAsInteger()) {
      Appearance.GaugeVarioAveNeedle = 
        (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAppAveNeedle,Appearance.GaugeVarioAveNeedle);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppInfoBoxColors"));
  if (wp) {
    if ((int)(Appearance.InfoBoxColors) != 
	wp->GetDataField()->GetAsInteger()) {
      Appearance.InfoBoxColors = (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAppInfoBoxColors,Appearance.InfoBoxColors);
      requirerestart = true;
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioSpeedToFly"));
  if (wp) {
    if ((int)(Appearance.GaugeVarioSpeedToFly) != wp->GetDataField()->GetAsInteger()) {
      Appearance.GaugeVarioSpeedToFly = (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAppGaugeVarioSpeedToFly,Appearance.GaugeVarioSpeedToFly);
      changed = true;
      requirerestart = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioAvgText"));
  if (wp) {
    if ((int)Appearance.GaugeVarioAvgText != wp->GetDataField()->GetAsInteger()) {
      Appearance.GaugeVarioAvgText = (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAppGaugeVarioAvgText,Appearance.GaugeVarioAvgText);
      changed = true;
      requirerestart = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioGross"));
  if (wp) {
    if ((int)Appearance.GaugeVarioGross != wp->GetDataField()->GetAsInteger()) {
      Appearance.GaugeVarioGross = (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAppGaugeVarioGross,Appearance.GaugeVarioGross);
      changed = true;
      requirerestart = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioMc"));
  if (wp) {
    if ((int)Appearance.GaugeVarioMc != wp->GetDataField()->GetAsInteger()) {
      Appearance.GaugeVarioMc = (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAppGaugeVarioMc,Appearance.GaugeVarioMc);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioBugs"));
  if (wp) {
    if ((int)Appearance.GaugeVarioBugs != wp->GetDataField()->GetAsInteger()) {
      Appearance.GaugeVarioBugs = (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAppGaugeVarioBugs,Appearance.GaugeVarioBugs);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAppGaugeVarioBallast"));
  if (wp) {
    if ((int)Appearance.GaugeVarioBallast != wp->GetDataField()->GetAsInteger()) {
      Appearance.GaugeVarioBallast = (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAppGaugeVarioBallast,Appearance.GaugeVarioBallast);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoBlank"));
  if (wp) {
    if (EnableAutoBlank != (wp->GetDataField()->GetAsInteger()!=0)) {
      EnableAutoBlank = (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAutoBlank, EnableAutoBlank);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoBacklight")); // VENTA4
  if (wp) {
    if (EnableAutoBacklight != (wp->GetDataField()->GetAsInteger()!=0)) {
      EnableAutoBacklight = (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAutoBacklight, EnableAutoBacklight);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoSoundVolume")); // VENTA4
  if (wp) {
    if (EnableAutoSoundVolume != (wp->GetDataField()->GetAsInteger()!=0)) {
      EnableAutoSoundVolume = (wp->GetDataField()->GetAsInteger() != 0);
      SetToRegistry(szRegistryAutoSoundVolume, EnableAutoSoundVolume);
      changed = true;
    }
  }


  wp = (WndProperty*)wf->FindByName(TEXT("prpTerrainContrast"));
  if (wp) {
    if (iround(TerrainContrast*100/255) != 
	wp->GetDataField()->GetAsInteger()) {
      TerrainContrast = (short)iround(wp->GetDataField()->GetAsInteger()*255.0/100);
      SetToRegistry(szRegistryTerrainContrast,TerrainContrast);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTerrainBrightness"));
  if (wp) {
    if (iround(TerrainBrightness*100/255) != 
	wp->GetDataField()->GetAsInteger()) {
      TerrainBrightness = (short)iround(wp->GetDataField()->GetAsInteger()*255.0/100);
      SetToRegistry(szRegistryTerrainBrightness,TerrainBrightness);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpTerrainRamp"));
  if (wp) {
    if (TerrainRamp != wp->GetDataField()->GetAsInteger()) {
      TerrainRamp = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryTerrainRamp, TerrainRamp);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpFinishMinHeight"));
  if (wp) {
    ival = iround( (wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY)*1000.0); // 100315 BUGFIX XCSOAr
    if ((int)FinishMinHeight != ival) {
      FinishMinHeight = ival;
      SetToRegistry(szRegistryFinishMinHeight,FinishMinHeight);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpStartMaxHeight"));
  if (wp) {
    ival = iround( (wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY) *1000.0); // 100315 BUGFIX XCSOAR
    if ((int)StartMaxHeight != ival) {
      StartMaxHeight = ival;
      SetToRegistry(szRegistryStartMaxHeight,StartMaxHeight);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpStartMaxHeightMargin"));
  if (wp) {
    ival = iround( (wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY) *1000.0 ); // 100315
    if ((int)StartMaxHeightMargin != ival) {
      StartMaxHeightMargin = ival;
      SetToRegistry(szRegistryStartMaxHeightMargin,StartMaxHeightMargin);
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpStartHeightRef"));
  if (wp) {
    if (StartHeightRef != wp->GetDataField()->GetAsInteger()) {
      StartHeightRef = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryStartHeightRef, StartHeightRef);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpStartMaxSpeed"));
  if (wp) {
    ival = iround( (wp->GetDataField()->GetAsInteger()/SPEEDMODIFY)*1000.0);  
    if (((int)StartMaxSpeed) != ival) {
	StartMaxSpeed = ival;
	SetToRegistry(szRegistryStartMaxSpeed,StartMaxSpeed);
	changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpStartMaxSpeedMargin"));
  if (wp) {
    ival = iround((wp->GetDataField()->GetAsInteger()/SPEEDMODIFY)*1000.0); 
    if ((int)StartMaxSpeedMargin != ival) {
      StartMaxSpeedMargin = ival;
      SetToRegistry(szRegistryStartMaxSpeedMargin,StartMaxSpeedMargin);
      changed = true;
    }
  }
  wp = (WndProperty*)wf->FindByName(TEXT("prpAutoAdvance"));
  if (wp) {
    if (AutoAdvance != wp->GetDataField()->GetAsInteger()) {
      AutoAdvance = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistryAutoAdvance,
		    AutoAdvance);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLoggerTimeStepCruise"));
  if (wp) {
    ival = iround(wp->GetDataField()->GetAsInteger());
    if (LoggerTimeStepCruise != ival) {
      LoggerTimeStepCruise = ival;
      SetToRegistry(szRegistryLoggerTimeStepCruise,LoggerTimeStepCruise);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpLoggerTimeStepCircling"));
  if (wp) {
    ival = iround(wp->GetDataField()->GetAsInteger());
    if (LoggerTimeStepCircling != ival) {
      LoggerTimeStepCircling = ival;
      SetToRegistry(szRegistryLoggerTimeStepCircling,LoggerTimeStepCircling);
      changed = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComPort1"));
  if (wp) {
    if ((int)dwPortIndex1 != wp->GetDataField()->GetAsInteger()) {
      dwPortIndex1 = wp->GetDataField()->GetAsInteger();
      changed = true;
      COMPORTCHANGED = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComSpeed1"));
  if (wp) {
    if ((int)dwSpeedIndex1 != wp->GetDataField()->GetAsInteger()) {
      dwSpeedIndex1 = wp->GetDataField()->GetAsInteger();
      changed = true;
      COMPORTCHANGED = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComBit1"));
  if (wp) {
    if ((int)dwBit1Index != wp->GetDataField()->GetAsInteger()) {
      dwBit1Index = wp->GetDataField()->GetAsInteger();
      changed = true;
      COMPORTCHANGED = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComDevice1"));
  if (wp) {
    if (dwDeviceIndex1 != wp->GetDataField()->GetAsInteger()) {
      dwDeviceIndex1 = wp->GetDataField()->GetAsInteger();
      changed = true;
      COMPORTCHANGED = true;
      devRegisterGetName(dwDeviceIndex1, DeviceName);
      WriteDeviceSettings(0, DeviceName);  
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComPort2"));
  if (wp) {
    if ((int)dwPortIndex2 != wp->GetDataField()->GetAsInteger()) {
      dwPortIndex2 = wp->GetDataField()->GetAsInteger();
      changed = true;
      COMPORTCHANGED = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComSpeed2"));
  if (wp) {
    if ((int)dwSpeedIndex2 != wp->GetDataField()->GetAsInteger()) {
      dwSpeedIndex2 = wp->GetDataField()->GetAsInteger();
      changed = true;
      COMPORTCHANGED = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComBit1"));
  if (wp) {
    if ((int)dwBit1Index != wp->GetDataField()->GetAsInteger()) {
      dwBit1Index = wp->GetDataField()->GetAsInteger();
      changed = true;
      COMPORTCHANGED = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpComDevice2"));
  if (wp) {
    if (dwDeviceIndex2 != wp->GetDataField()->GetAsInteger()) {
      dwDeviceIndex2 = wp->GetDataField()->GetAsInteger();
      changed = true;
      COMPORTCHANGED = true;
      devRegisterGetName(dwDeviceIndex2, DeviceName);
      WriteDeviceSettings(1, DeviceName);  
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpSnailWidthScale"));
  if (wp) {
    if (MapWindow::SnailWidthScale != wp->GetDataField()->GetAsInteger()) {
      MapWindow::SnailWidthScale = wp->GetDataField()->GetAsInteger();
      SetToRegistry(szRegistrySnailWidthScale,MapWindow::SnailWidthScale);
      changed = true;
      requirerestart = true;
    }
  }

  wp = (WndProperty*)wf->FindByName(TEXT("prpEngineeringMenu")); // VENTA9
  if (wp) EngineeringMenu = wp->GetDataField()->GetAsInteger();

  if (COMPORTCHANGED) {
    WritePort1Settings(dwPortIndex1,dwSpeedIndex1, dwBit1Index);
    WritePort2Settings(dwPortIndex2,dwSpeedIndex2, dwBit2Index);
  }

  int i,j;
  for (i=0; i<4; i++) {
    for (j=0; j<9; j++) {
      GetInfoBoxSelector(j, i);
    }
  }

  if (waypointneedsave) {
    if(MessageBoxX(hWndMapWindow,
                   gettext(TEXT("Save changes to waypoint file?")),
                   gettext(TEXT("Waypoints edited")),
                   MB_YESNO|MB_ICONQUESTION) == IDYES) {
    
      AskWaypointSave();

    }
  }

  if (taskchanged) {
    RefreshTask();
  }

#if (WINDOWSPC>0)
  if (COMPORTCHANGED) {
    requirerestart = true;
  }
#endif

  if (changed) {

	PGOpenTime=((PGOpenTimeH*60)+PGOpenTimeM)*60;
	PGCloseTime=PGOpenTime+(PGGateIntervalTime*PGNumberOfGates*60);
	if (PGCloseTime>86399) PGCloseTime=86399; // 23:59:59
	ActiveGate=-1;


    StoreRegistry();

    if (!requirerestart) {
      MessageBoxX (hWndMainWindow, 
		   gettext(TEXT("Changes to configuration saved.")), 
		   TEXT("Configuration"), MB_OK);
    } else {

      MessageBoxX (hWndMainWindow, 
		   gettext(TEXT("Restart LK8000 to apply changes.")), 
		   TEXT("Configuration"), MB_OK);
    }
  }

  delete wf;

  wf = NULL;

}

@


8.11
log
@*** empty log message ***
@
text
@d2 3
a4 1
Copyright_License {
d6 1
a6 32
  XCSoar Glide Computer - http://xcsoar.sourceforge.net/
  Copyright (C) 2000 - 2008  

  	M Roberts (original release)
	Robin Birch <robinb@@ruffnready.co.uk>
	Samuel Gisiger <samuel.gisiger@@triadis.ch>
	Jeff Goodenough <jeff@@enborne.f2s.com>
	Alastair Harrison <aharrison@@magic.force9.co.uk>
	Scott Penrose <scottp@@dd.com.au>
	John Wharington <jwharington@@gmail.com>
	Lars H <lars_hn@@hotmail.com>
	Rob Dunning <rob@@raspberryridgesheepfarm.com>
	Russell King <rmk@@arm.linux.org.uk>
	Paolo Ventafridda <coolwind@@email.it>
	Tobias Lohner <tobias@@lohner-net.de>

  This program is free software; you can redistribute it and/or
  modify it under the terms of the GNU General Public License
  as published by the Free Software Foundation; either version 2
  of the License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with this program; if not, write to the Free Software
  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.

  $Id: dlgConfiguration.cpp,v 8.10 2009/11/14 23:45:09 root Exp root $
}
d37 1
a37 1

d58 1
a58 1
#define ISPARAGLIDER (AircraftCategory == (AircraftCategory_t)umParaglider)
d68 2
a69 2

int UserLevel = 0;
d104 3
a106 3
static WndFrame *wConfig26=NULL; 
static WndFrame *wConfig27=NULL; 
///: ADDPAGE FIX HERE
d114 1
a114 1
#define NUMPAGES 27 		// ADDPAGE FIX HERE
d142 1
a142 1
    _stprintf(text,TEXT("%s: %s"), gettext(TEXT("Competition ID")), val);
d161 2
a162 2
	  if (config_page>=(NUMPAGES-4)) { config_page=0; } // ADDPAGE FIX HERE
	  if (config_page<0) { config_page=NUMPAGES-5; } // ADDPAGE FIX HERE
d205 1
a205 1
    wf->SetCaption(gettext(TEXT("13 Screen Instruments")));
d217 1
a217 1
    wf->SetCaption(gettext(TEXT("17 InfoBox Circling")));
d238 1
a238 1
    wf->SetCaption(gettext(TEXT("24 Engineering Menu 1")));
d241 1
a241 1
    wf->SetCaption(gettext(TEXT("25 Engineering Menu 2")));
d244 1
a244 1
    wf->SetCaption(gettext(TEXT("26 Engineering Menu 3")));
d247 1
a247 1
    wf->SetCaption(gettext(TEXT("27 Engineering Menu 4: old Vario")));
d290 2
a291 2
  wConfig26->SetVisible(config_page == 25);  
  wConfig27->SetVisible(config_page == 26);  
d306 7
d319 1
d321 1
d323 1
a323 1

d340 7
a346 1

d353 2
a354 1

d356 1
d414 1
a414 1
		StartupStore(_T("........... DBG-901")); // 091105
d430 1
a430 1
		StartupStore(_T("........... DBG-902")); // 091105
d446 1
a446 1
		StartupStore(_T("........... DBG-903")); // 091105
d647 1
a647 1
		StartupStore(_T("........... DBG-904")); // 091105
d804 17
a876 1
  ///: for (int item=0; item<numInfoWindows; item++) {  BUGFIX TESTFIX 091016 
a899 1
    ///: for (int item=0; item<numInfoWindows; item++) { BUGFIX TESTFIX 091016
d960 1
a960 1
		StartupStore(_T("........... DBG-905")); // 091105
d989 1
a989 1
		StartupStore(_T("........... DBG-907")); // 091105
d1024 1
a1024 1
		StartupStore(_T("........... DBG-906")); // 091105
d1035 11
a1045 1
  
d1051 4
d1056 1
d1060 9
d1070 13
d1101 23
a1159 1

d1164 24
a1187 11
  if (res != -1){
    if(MessageBoxX(hWndMapWindow,
                   WayPointList[res].Name,
                   gettext(TEXT("Delete Waypoint?")),
                   MB_YESNO|MB_ICONQUESTION) == IDYES) {

      LockTaskData();
      WayPointList[res].FileNum = -1;
      UnlockTaskData();
      waypointneedsave = true;
    }
d1223 4
a1226 1

a1324 5



//////////

d1341 1
d1344 1
d1348 1
a1348 1
static  DWORD Speed = 1; // default is knots
d1351 2
a1352 2
static  DWORD Lift = 0;
static  DWORD Altitude = 0; //default ft
a1388 16
  //////////
  /*
  config_page = 0;

  NextPage(0); // JMW just to turn proper pages on/off

  wf->ShowModal();

  delete wf;

  wf = NULL;

  return; 
  */

  ///////////////////
d1400 2
a1401 2
  ///////////////////
///: 091117 extended COM ports for PC
d1413 1
a1413 1
			       TEXT("COM9"),TEXT("COM10"),TEXT("COM0")};
d1421 1
a1421 1
  ReadPort1Settings(&dwPortIndex1,&dwSpeedIndex1);
d1430 1
a1430 1
    for (i=0; i<11; i++) {
d1448 9
a1457 3
///: BUGFIX 091021 devA and devB not loading name from PC non sim
///: #ifdef _SIM_  
///: #if ((_SIM_) || (WINDOWSPC>0)) 091101 
a1461 1
///: #endif 091101
a1469 11
/*
#ifndef _SIM_
      if (devA() != NULL){
	if (_tcscmp(DeviceName, devA()->Name) == 0)
	  dwDeviceIndex1 = i;
      }
#else
      if (_tcscmp(DeviceName, deviceName1) == 0)
        dwDeviceIndex1 = i;
#endif
*/
a1470 2
///: BUGFIX 091021 devA devB names
//#if  ((_SIM_) || (WINDOWSPC>0)) 091101
a1472 10
/* 091101
#else
      if (devA() != NULL){
	if (_tcscmp(DeviceName, devA()->Name) == 0)
	  dwDeviceIndex1 = i;
      }
#endif
*/


d1480 1
a1480 1
  ReadPort2Settings(&dwPortIndex2,&dwSpeedIndex2);
d1489 1
a1489 1
    for (i=0; i<11; i++) {
d1508 9
a1524 13
/*
#ifndef _SIM_
      if (devB() != NULL){
	if (_tcscmp(DeviceName, devB()->Name) == 0)
	  dwDeviceIndex2 = i;
      }
#else
      if (_tcscmp(DeviceName, deviceName2) == 0)
        dwDeviceIndex2 = i;
#endif
*/
///: BUGFIX 091021 devA devB names
//#if ( (_SIM_) || (WINDOWSPC>0)) 091101
a1526 8
/* 091101
#else
      if (devB() != NULL){
	if (_tcscmp(DeviceName, devB()->Name) == 0)
	  dwDeviceIndex2 = i;
      }
#endif
*/
d1617 1
d1623 1
d1685 4
d1690 1
d1737 10
d1776 4
a1779 1
    dfe->addEnumText(gettext(TEXT("Both")));
a1806 2
  ////

d1837 2
d1840 1
a1840 1
    ///: if (!ISPARAGLIDER) wp->SetVisible(false);  091115
d1846 1
a1846 1
    ///: if (!ISPARAGLIDER) wp->SetVisible(false); 091115
d1849 39
a1887 1
  ////
d1897 1
a1897 1
    dfe->addEnumText(gettext(TEXT("Statue")));
d1912 3
d1957 2
a1958 2
    dfe->addEnumText(gettext(TEXT("Feet")));
    dfe->addEnumText(gettext(TEXT("Meters")));
d1971 2
a1972 2
    dfe->addEnumText(gettext(TEXT("Knots")));
    dfe->addEnumText(gettext(TEXT("M/s")));
d1988 1
a1988 1
    dfe->addEnumText(gettext(TEXT("Circle at center")));
d2045 6
d2070 13
a2119 1
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.plr")); 091101
a2132 1
    ///: dfe->ScanDirectoryTop(_T(LKD_AIRSPACES),TEXT("*.txt")); 091101
a2146 1
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.txt")); 091101
a2159 2
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.dat")); 091101
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.xcw")); 091101
d2164 6
a2181 2
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.dat")); 091101
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.xcw")); 091101
d2186 6
a2202 1
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.xcm")); 091102
d2205 2
a2217 2
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.dat")); 091102
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.jp2")); 091102
d2220 2
a2234 1
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.tpl")); 091102
a2247 1
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.txt")); 091102
d2249 1
a2249 1
    dfe->ScanDirectoryTop(_T(LKD_CONF),tsuf);
d2256 3
a2263 1
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.xcl")); 091102
d2265 1
a2265 1
    dfe->ScanDirectoryTop(_T(LKD_CONF),tsuf);
a2276 1
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.xcs")); 091102
a2289 1
    ///: dfe->ScanDirectoryTop(_T(""),TEXT("*.xci")); 091102
d2338 8
a2345 8
	dfe->addEnumText(gettext(TEXT("vario+9box"))); // 0
	dfe->addEnumText(gettext(TEXT("(empty) A")));  // 1 
	dfe->addEnumText(gettext(TEXT("(empty) B")));  // 2 
	dfe->addEnumText(gettext(TEXT("(empty) C")));  // 3
	dfe->addEnumText(gettext(TEXT("8box left")));  // 4
	dfe->addEnumText(gettext(TEXT("8box right"))); // 5 VENTA3
	dfe->addEnumText(gettext(TEXT("(empty) D")));  // 6
	dfe->addEnumText(gettext(TEXT("5box right"))); // 7
d2350 8
a2357 14
// VENTA2 FIX portrait mode selection geometry
	dfe->addEnumText(gettext(TEXT("top+bottom"))); // 0
	dfe->addEnumText(gettext(TEXT("bottom")));     // 1
	dfe->addEnumText(gettext(TEXT("top")));        // 2 
	dfe->addEnumText(gettext(TEXT("3 free"))); // 3
	dfe->addEnumText(gettext(TEXT("4 free")));       // 4
	dfe->addEnumText(gettext(TEXT("5 free")));      // 5
	dfe->addEnumText(gettext(TEXT("6 free")));      // 6

	//dfe->addEnumText(gettext(TEXT("left+right"))); // 3
	//dfe->addEnumText(gettext(TEXT("left")));       // 4
	//dfe->addEnumText(gettext(TEXT("right")));      // 5
	//dfe->addEnumText(gettext(TEXT("vario")));      // 6
	dfe->addEnumText(gettext(TEXT("7")));          // 7
d2372 7
a2378 6
    dfe->addEnumText(gettext(TEXT("Generic")));
    dfe->addEnumText(gettext(TEXT("HP31x")));
    dfe->addEnumText(gettext(TEXT("MedionP5")));
    dfe->addEnumText(gettext(TEXT("MIO")));
    dfe->addEnumText(gettext(TEXT("Nokia500"))); // VENTA3
    dfe->addEnumText(gettext(TEXT("PN6000")));
d2400 3
d2442 3
a2444 1
    dfe->addEnumText(gettext(TEXT("Paraglider")));
d2464 1
a2464 1
     dfe->addEnumText(gettext(TEXT("(Reserved)")));
a2466 1
     ///: if ( AircraftCategory != (AircraftCategory_t)umParaglider )  BUGFIX 091019
a2472 1
///: Disabled 091016
d2498 10
d2520 11
d2562 1
d2564 1
d2592 65
d2669 35
d2841 11
d2857 1
d2889 11
a2899 5
    dfe->addEnumText(gettext(TEXT("Imhof 7")));
    dfe->addEnumText(gettext(TEXT("Imhof 4")));
    dfe->addEnumText(gettext(TEXT("Imhof 12")));
    dfe->addEnumText(gettext(TEXT("Imhof Atlas")));
    dfe->addEnumText(gettext(TEXT("ICAO")));
d3053 1
a3053 1
    wp->GetDataField()->SetAsFloat(iround(FinishMinHeight*ALTITUDEMODIFY));
d3060 1
a3060 1
    wp->GetDataField()->SetAsFloat(iround(StartMaxHeight*ALTITUDEMODIFY));
d3067 1
a3067 1
    wp->GetDataField()->SetAsFloat(iround(StartMaxHeightMargin*ALTITUDEMODIFY));
d3084 1
a3084 1
    wp->GetDataField()->SetAsFloat(iround(StartMaxSpeed*SPEEDMODIFY));
d3091 1
a3091 1
    wp->GetDataField()->SetAsFloat(iround(StartMaxSpeedMargin*SPEEDMODIFY));
d3116 1
a3116 1
    wp->GetDataField()->SetAsFloat(GPSAltitudeOffset);
d3127 18
a3150 1
  ////
a3151 1
    ///: for (int j=0; j<numInfoWindows; j++) { BUGFIX TESTFIX 091016
d3165 1
a3165 1
  StartHourglassCursor();
d3215 3
a3217 4
  wConfig26    = ((WndFrame *)wf->FindByName(TEXT("frmEngineering3")));
  wConfig27    = ((WndFrame *)wf->FindByName(TEXT("frmEngineering4")));
  ///: ADDPAGE FIX HERE

d3243 3
a3245 3
  ASSERT(wConfig26!=NULL);
  ASSERT(wConfig27!=NULL);
  ///: ADDPAGE FIX HERE
d3249 1
a3249 1
// VENTA2- FIVV special version
d3378 9
d3393 2
a3394 1
      requirerestart=true;
d3403 2
a3404 1
      requirerestart=true;
d3408 51
a3458 1
// VENTA3: do not save VisualGlide to registry or profile
d3522 1
d3533 1
d3668 8
d3681 1
d3781 17
a3902 1
    ///: int val  = wp->GetDataField()->GetAsInteger(); TESTFIX BUGFIX 091007 shadowing previous declaration, using ival
d4037 2
a4038 1
      requirerestart = true;
d4079 10
d4091 2
a4092 2
    ival = iround(wp->GetDataField()->GetAsInteger()/SPEEDMODIFY);
    if (SAFTEYSPEED != ival) {
d4095 1
d4101 11
a4247 1
  ///: Disabled 091016
d4273 1
a4273 1
  wp = (WndProperty*)wf->FindByName(TEXT("prpIphoneGestures")); 
d4275 1
a4275 1
    if (IphoneGestures != (IphoneGestures_t)
d4277 1
a4277 1
      IphoneGestures = (IphoneGestures_t)
d4279 2
a4280 2
      SetToRegistry(szRegistryIphoneGestures,
		    (DWORD)(IphoneGestures));
d4284 19
d4348 1
d4351 53
a4403 6
    if (UseMapLock != (UseMapLock_t)
	(wp->GetDataField()->GetAsInteger())) {
      UseMapLock = (UseMapLock_t)
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryUseMapLock,
		    (DWORD)(UseMapLock));
d4407 2
d4418 14
d4434 14
d4486 8
d4499 1
d4511 19
d4611 3
d4716 3
d4872 1
a4872 1
    ival = iround(wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY);
d4882 1
a4882 1
    ival = iround(wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY);
d4892 1
a4892 1
    ival = iround(wp->GetDataField()->GetAsInteger()/ALTITUDEMODIFY);
d4910 5
a4914 5
    ival = iround(wp->GetDataField()->GetAsInteger()/SPEEDMODIFY);
    if ((int)StartMaxSpeed != ival) {
      StartMaxSpeed = ival;
      SetToRegistry(szRegistryStartMaxSpeed,StartMaxSpeed);
      changed = true;
d4920 1
a4920 1
    ival = iround(wp->GetDataField()->GetAsInteger()/SPEEDMODIFY);
d4975 9
d5013 9
a5042 6
///: 091021 CHECK REMOVABLE this was used when value was not saved to registry!
//  if ( CALCULATED_INFO.OnGround == TRUE ) { 
	  wp = (WndProperty*)wf->FindByName(TEXT("prpGPSAltitudeOffset")); // VENTA3
	  if (wp) GPSAltitudeOffset = wp->GetDataField()->GetAsInteger();
//  }

d5047 2
a5048 2
    WritePort1Settings(dwPortIndex1,dwSpeedIndex1);
    WritePort2Settings(dwPortIndex2,dwSpeedIndex2);
a5052 1
    ///: for (j=0; j<numInfoWindows; j++) { TESTFIX BUGFIX 091016
d5080 7
d5092 1
a5092 1
		   TEXT(""), MB_OK);
d5096 2
a5097 2
		   gettext(TEXT("Changes to configuration saved.  Restart LK8000 to apply changes.")), 
		   TEXT(""), MB_OK);
@


8.10
log
@1.17a
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 8.9 2009/11/06 22:50:20 root Exp root $
d134 2
d143 1
a143 1
#define NUMPAGES 26
d190 2
a191 2
	  if (config_page>=(NUMPAGES-3)) { config_page=0; }
	  if (config_page<0) { config_page=NUMPAGES-4; }
d216 1
a216 1
    wf->SetCaption(gettext(TEXT("7 Polar")));
d234 1
a234 1
    wf->SetCaption(gettext(TEXT("13 Vario Gauge and FLARM")));
d261 1
a261 1
    wf->SetCaption(gettext(TEXT("22 Specials")));
d264 1
a264 1
    wf->SetCaption(gettext(TEXT("23 LK8000 mode")));
d275 4
a278 1
  }
d320 2
a321 1
}
d1342 10
a1351 1
  
d1355 1
d1368 3
d1372 1
d1445 3
d1449 1
d1791 1
a1791 1
    if (!ISPARAGLIDER) wp->SetVisible(false); 
d1797 1
a1797 1
    if (!ISPARAGLIDER) wp->SetVisible(false); 
d2350 4
a2353 3
    dfe = (DataFieldEnum*)wp->GetDataField();
     dfe->addEnumText(gettext(TEXT("Disabled")));
     dfe->addEnumText(gettext(TEXT("Half map overlay")));
d2355 2
a2356 2
    	dfe->addEnumText(gettext(TEXT("Full map overlay")));
     dfe = (DataFieldEnum*)wp->GetDataField();
d2392 11
d2404 4
a2407 1
    dfe->addEnumText(gettext(TEXT("Enabled")));
d2409 1
a2409 1
    dfe->Set(IphoneGestures);
d2714 1
a2714 1
    wp->SetVisible(false);
d2725 1
a2725 1
    wp->SetVisible(false);
d2948 2
d2977 2
d3863 4
a3866 3
      SetToRegistry(szRegistryLook8000,
		    (DWORD)(Look8000));
      changed = true;
d3907 11
@


8.9
log
@1.16a
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 8.8 2009/11/05 19:21:08 root Exp root $
d87 2
d1759 17
d2494 19
d3068 19
d3986 10
d4515 1
a4515 1
		   gettext(TEXT("Changes to configuration saved.  Restart XCSoar to apply changes.")), 
@


8.8
log
@*** empty log message ***
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 8.7 2009/11/01 15:19:50 root Exp root $
d131 1
d139 1
a139 1
#define NUMPAGES 25
d185 3
a187 3
  if (!EngineeringMenu) { // VENTA10 
	  if (config_page>=(NUMPAGES-2)) { config_page=0; }
	  if (config_page<0) { config_page=NUMPAGES-3; }
d268 3
d312 1
d417 3
d433 3
d449 3
d650 3
d948 3
d977 3
d1012 3
d2344 11
d2870 1
d2897 1
d3795 11
@


8.7
log
@1.15b
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 8.6 2009/10/19 22:29:46 root Exp root $
d1251 1
d1344 1
a1344 1
#if ((_SIM_) || (WINDOWSPC>0))
d1349 1
a1349 1
#endif
d1371 1
a1371 1
#if  ((_SIM_) || (WINDOWSPC>0))
d1374 1
d1381 1
d1435 1
a1435 1
#if ( (_SIM_) || (WINDOWSPC>0))
d1438 1
d1445 1
d1942 3
a1944 1
    dfe->ScanDirectoryTop(TEXT("*.plr"));
d1956 3
a1958 1
    dfe->ScanDirectoryTop(TEXT("*.txt"));
d1971 3
a1973 1
    dfe->ScanDirectoryTop(TEXT("*.txt"));
d1985 6
a1990 2
    dfe->ScanDirectoryTop(TEXT("*.dat"));
    dfe->ScanDirectoryTop(TEXT("*.xcw"));
d2003 6
a2008 2
    dfe->ScanDirectoryTop(TEXT("*.dat"));
    dfe->ScanDirectoryTop(TEXT("*.xcw"));
d2020 3
a2022 1
    dfe->ScanDirectoryTop(TEXT("*.xcm"));
d2034 6
a2039 2
    dfe->ScanDirectoryTop(TEXT("*.dat"));
    dfe->ScanDirectoryTop(TEXT("*.jp2"));
d2051 3
a2053 1
    dfe->ScanDirectoryTop(TEXT("*.tpl"));
d2065 3
a2067 1
    dfe->ScanDirectoryTop(TEXT("*.txt"));
d2079 3
a2081 1
    dfe->ScanDirectoryTop(TEXT("*.xcl"));
d2093 3
a2095 1
    dfe->ScanDirectoryTop(TEXT("*.xcs"));
d2107 3
a2109 1
    dfe->ScanDirectoryTop(TEXT("*.xci"));
@


8.6
log
@1.14b
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 8.5 2009/10/12 16:13:10 root Exp root $
d1341 3
a1343 1
#ifdef _SIM_
d1357 1
d1367 15
d1420 1
d1430 11
d2248 3
a2250 3
     dfe->addEnumText(gettext(TEXT("Standard")));
     if ( AircraftCategory != (AircraftCategory_t)umParaglider ) 
    	dfe->addEnumText(gettext(TEXT("Advanced")));
a2712 1
#ifdef FIVV
d2719 6
a2724 1
#endif
a3812 1
#ifdef FIVV
d3815 3
a3817 6
    if (GPSAltitudeOffset != 
	(wp->GetDataField()->GetAsInteger())) {
      GPSAltitudeOffset = 
	(wp->GetDataField()->GetAsInteger());
      SetToRegistry(szRegistryGpsAltitudeOffset,
		    (DWORD)(GPSAltitudeOffset));
d3821 10
a3830 1
#endif
d4310 1
a4310 1
#ifdef FIVV
a4314 1
#endif
@


8.5
log
@1.12
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 8.4 2009/06/28 21:31:53 root Exp root $
d847 2
a848 1
  for (int item=0; item<numInfoWindows; item++) {
d871 2
a872 1
    for (int item=0; item<numInfoWindows; item++) {
d2225 3
d2235 1
d2240 1
d2700 2
a2701 1
    for (int j=0; j<numInfoWindows; j++) {
d3660 3
d3674 1
d4288 2
a4289 1
    for (j=0; j<numInfoWindows; j++) {
@


8.4
log
@ok
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 8.3 2009/06/27 17:18:20 root Exp root $
d259 1
a259 1
    wf->SetCaption(gettext(TEXT("23 New Map Mode")));
d1427 9
d2223 11
d2257 12
d2677 1
a2677 1
  wp = (WndProperty*)wf->FindByName(TEXT("prpGPSAltitudeOffset")); // VENTA3 GPSAltitudeOffset
d2936 9
d3331 4
a3334 3
    int val  = wp->GetDataField()->GetAsInteger();
    if (Handicap != val) {
      Handicap = val;
d3641 1
a3641 1
  wp = (WndProperty*)wf->FindByName(TEXT("prpLook8000")); // VENTA4
d3652 13
a3664 1
  wp = (WndProperty*)wf->FindByName(TEXT("prpNewMap")); // VENTA4
d3687 11
d3767 14
@


8.3
log
@ok
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 8.2 2009/06/24 10:03:43 root Exp root $
d129 2
d138 1
a138 1
#define NUMPAGES 23
d184 7
a190 2
  if (config_page>=NUMPAGES) { config_page=0; }
  if (config_page<0) { config_page=NUMPAGES-1; }
d261 6
d306 2
d2163 5
a2167 1
    wp->SetVisible(false); // currently no need to display default
d2170 3
d2174 1
d2653 6
d2722 2
d2748 2
d4181 1
a4181 1
//  if ( CALCULATED_INFO.OnGround == TRUE ) { // was != bug
d4187 3
@


8.2
log
@*** empty log message ***
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 8.1 2009/06/19 20:28:25 venta Exp root $
d2183 6
a2188 4
    dfe->addEnumText(gettext(TEXT("Enabled")));
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe = (DataFieldEnum*)wp->GetDataField();
    dfe->Set(Look8000);
d2196 1
a2197 1
    dfe->addEnumText(gettext(TEXT("Disabled")));
d2240 3
a2242 3
    dfe->addEnumText(gettext(TEXT("Disabled")));
    dfe->addEnumText(gettext(TEXT("Task&Landable")));
    dfe->addEnumText(gettext(TEXT("All turnpoints")));
d3550 1
a3550 1
     // requirerestart = true;
@


8.1
log
@beta8
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 1.3 2009/06/15 19:47:17 root Exp root $
d2212 22
d3598 22
@


1.3
log
@robs
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 1.2 2009/06/01 21:18:57 root Exp root $
@


1.2
log
@funziona
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 1.1 2009/05/27 12:04:05 root Exp root $
a2215 1
    dfe->addEnumText(gettext(TEXT("Enabled")));
d2217 2
d2224 13
d3564 1
a3564 1
  wp = (WndProperty*)wf->FindByName(TEXT("prpHideUnits")); // VENTA4
d3576 1
a3576 1
  wp = (WndProperty*)wf->FindByName(TEXT("prpOutlinedTp")); // VENTA4
d3587 11
d3599 1
a3599 1
  wp = (WndProperty*)wf->FindByName(TEXT("prpGlideBarMode")); // VENTA4
@



1.1
log
@Initial revision
@
text
@d34 1
a34 1
  $Id: dlgConfiguration.cpp,v 1.83 2009/05/24 10:56:52 jwharington Exp $
d43 1
a2178 1

d2246 27
d3586 26
a3611 1
  wp = (WndProperty*)wf->FindByName(TEXT("prpArrivalValue")); // VENTA4
@
